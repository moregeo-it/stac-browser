import{a3 as gt,G as De,x as Ue,E as ce,bf as nt,P as de,F as dt,bn as xt,bg as Oe,L as $e}from"./index-DLQIbJqc.js";import{bz as mt,bA as yt,bt as it,bB as wt,bC as Et,V as Ne,J as Ce,bD as vt,bE as St,bF as je,F as Ie,bG as He,bH as _t,be as Tt,t as bt,bI as Xe,d as rt,R as Ae,B as Ot,M as It,K as Pt,N as Mt,G as Pe,H as Rt,i as Lt,h as Nt,bJ as Ct,bK as At,a as Bt}from"./GeoJSON-dVJCj0SI.js";import{t as Ft}from"./utils-B7F_ho2D.js";import"./_commonjsHelpers-CE1G-McA.js";import"./I18N-DlIXJTel.js";import"./BFormRadioGroup.vue_vue_type_script_setup_true_lang-LQBMttYK-CW7mqt87.js";import"./useStateClass-BGbSLWFN-DVCkhww4.js";import"./ConditionalWrapper.vue_vue_type_script_lang-IX_NpHH--D04gVupl.js";const Gt={viewBox:"0 0 16 16",width:"1.2em",height:"1.2em"};function kt(n,e){return Ue(),De("svg",Gt,[...e[0]||(e[0]=[ce("g",{fill:"currentColor","fill-rule":"evenodd"},[ce("path",{d:"M3.1 11.2a.5.5 0 0 1 .4-.2H6a.5.5 0 0 1 0 1H3.75L1.5 15h13l-2.25-3H10a.5.5 0 0 1 0-1h2.5a.5.5 0 0 1 .4.2l3 4a.5.5 0 0 1-.4.8H.5a.5.5 0 0 1-.4-.8z"}),ce("path",{d:"M4 4a4 4 0 1 1 4.5 3.969V13.5a.5.5 0 0 1-1 0V7.97A4 4 0 0 1 4 3.999z"})],-1)])])}const qt=gt({name:"bi-pin-map-fill",render:kt}),Dt={name:"UserLocationControl",mixins:[mt],props:{maxZoom:{type:Number,default:void 0}},methods:{request(){"geolocation"in navigator&&navigator.geolocation.getCurrentPosition(n=>{const e=this.map.getView(),t=yt([n.coords.longitude,n.coords.latitude],e.getProjection()),s=new it(t);e.fit(s,{maxZoom:this.maxZoom})},n=>this.$store.commit("showGlobalError",{error:n,message:n.message}),{maximumAge:1/0})}}},Ut={class:"ol-location ol-unselectable ol-control",style:{"pointer-events":"auto"}},Vt=["title"];function zt(n,e,t,s,i,a){const x=qt;return Ue(),De("div",Ut,[ce("button",{onClick:e[0]||(e[0]=dt((...h)=>a.request&&a.request(...h),["prevent","stop"])),title:n.$t("mapping.location.description")},[de(x)],8,Vt)])}const $t=nt(Dt,[["render",zt],["__scopeId","data-v-f8d6420b"]]),jt={EXTENTCHANGED:"extentchanged"};class Ht extends Ot{constructor(e){super(jt.EXTENTCHANGED),this.extent=e}}class Xt extends wt{constructor(e){e=e||{},super(e),this.on,this.once,this.un,this.condition_=e.condition?e.condition:Et,this.extent_=null,this.pointerHandler_=null,this.pixelTolerance_=e.pixelTolerance!==void 0?e.pixelTolerance:10,this.snappedToVertex_=!1,this.extentFeature_=null,this.vertexFeature_=null,e||(e={}),this.extentOverlay_=new Ne({source:new Ce({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.boxStyle?e.boxStyle:Zt(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.vertexOverlay_=new Ne({source:new Ce({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.pointerStyle?e.pointerStyle:Kt(),updateWhileAnimating:!0,updateWhileInteracting:!0}),e.extent&&this.setExtent(e.extent)}snapToVertex_(e,t){const s=t.getCoordinateFromPixelInternal(e),i=function(x,h){return Xe(s,x)-Xe(s,h)},a=this.getExtentInternal();if(a){const x=Yt(a);x.sort(i);const h=x[0];let E=vt(s,h);const w=t.getPixelFromCoordinateInternal(E);if(St(e,w)<=this.pixelTolerance_){const b=t.getPixelFromCoordinateInternal(h[0]),_=t.getPixelFromCoordinateInternal(h[1]),I=je(w,b),N=je(w,_),D=Math.sqrt(Math.min(I,N));return this.snappedToVertex_=D<=this.pixelTolerance_,this.snappedToVertex_&&(E=I>N?h[1]:h[0]),E}}return null}handlePointerMove_(e){const t=e.pixel,s=e.map;let i=this.snapToVertex_(t,s);i||(i=s.getCoordinateFromPixelInternal(t)),this.createOrUpdatePointerFeature_(i)}createOrUpdateExtentFeature_(e){let t=this.extentFeature_;return t?e?t.setGeometry(He(e)):t.setGeometry(void 0):(e?t=new Ie(He(e)):t=new Ie({}),this.extentFeature_=t,this.extentOverlay_.getSource().addFeature(t)),t}createOrUpdatePointerFeature_(e){let t=this.vertexFeature_;return t?t.getGeometry().setCoordinates(e):(t=new Ie(new it(e)),this.vertexFeature_=t,this.vertexOverlay_.getSource().addFeature(t)),t}handleEvent(e){return!e.originalEvent||!this.condition_(e)?!0:(e.type==_t.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(e),super.handleEvent(e),!1)}handleDownEvent(e){const t=e.pixel,s=e.map,i=this.getExtentInternal();let a=this.snapToVertex_(t,s);const x=function(h){let E=null,w=null;return h[0]==i[0]?E=i[2]:h[0]==i[2]&&(E=i[0]),h[1]==i[1]?w=i[3]:h[1]==i[3]&&(w=i[1]),E!==null&&w!==null?[E,w]:null};if(a&&i){const h=a[0]==i[0]||a[0]==i[2]?a[0]:null,E=a[1]==i[1]||a[1]==i[3]?a[1]:null;h!==null&&E!==null?this.pointerHandler_=Ze(x(a)):h!==null?this.pointerHandler_=Ke(x([h,i[1]]),x([h,i[3]])):E!==null&&(this.pointerHandler_=Ke(x([i[0],E]),x([i[2],E])))}else a=s.getCoordinateFromPixelInternal(t),this.setExtent([a[0],a[1],a[0],a[1]]),this.pointerHandler_=Ze(a);return!0}handleDragEvent(e){if(this.pointerHandler_){const t=e.coordinate;this.setExtent(this.pointerHandler_(t)),this.createOrUpdatePointerFeature_(t)}}handleUpEvent(e){this.pointerHandler_=null;const t=this.getExtentInternal();return(!t||Tt(t)===0)&&this.setExtent(null),!1}setMap(e){this.extentOverlay_.setMap(e),this.vertexOverlay_.setMap(e),super.setMap(e)}getExtent(){return bt(this.getExtentInternal(),this.getMap().getView().getProjection())}getExtentInternal(){return this.extent_}setExtent(e){this.extent_=e||null,this.createOrUpdateExtentFeature_(e),this.dispatchEvent(new Ht(this.extent_))}}function Zt(){const n=rt();return function(e,t){return n.Polygon}}function Kt(){const n=rt();return function(e,t){return n.Point}}function Ze(n){return function(e){return Ae([n,e])}}function Ke(n,e){return n[0]==e[0]?function(t){return Ae([n,[t[0],e[1]]])}:n[1]==e[1]?function(t){return Ae([n,[e[0],t[1]]])}:null}function Yt(n){return[[[n[0],n[1]],[n[0],n[3]]],[[n[0],n[3]],[n[2],n[3]]],[[n[2],n[3]],[n[2],n[1]]],[[n[2],n[1]],[n[0],n[1]]]]}function st(n,e,t={}){const s={type:"Feature"};return(t.id===0||t.id)&&(s.id=t.id),t.bbox&&(s.bbox=t.bbox),s.properties={},s.geometry=n,s}function Jt(n,e,t={}){for(const i of n){if(i.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(i[i.length-1].length!==i[0].length)throw new Error("First and last Position are not equivalent.");for(let a=0;a<i[i.length-1].length;a++)if(i[i.length-1][a]!==i[0][a])throw new Error("First and last Position are not equivalent.")}return st({type:"Polygon",coordinates:n},e,t)}function Wt(n,e,t={}){return st({type:"MultiPolygon",coordinates:n},e,t)}var Qt=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,Me=Math.ceil,X=Math.floor,V="[BigNumber Error] ",Ye=V+"Number primitive has more than 15 significant digits: ",K=1e14,P=14,Re=9007199254740991,Le=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],ne=1e7,G=1e9;function ot(n){var e,t,s,i=S.prototype={constructor:S,toString:null,valueOf:null},a=new S(1),x=20,h=4,E=-7,w=21,b=-1e7,_=1e7,I=!1,N=1,D=0,z={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"Â ",suffix:""},k="0123456789abcdefghijklmnopqrstuvwxyz",ve=!0;function S(r,o){var l,d,c,p,y,u,f,m,g=this;if(!(g instanceof S))return new S(r,o);if(o==null){if(r&&r._isBigNumber===!0){g.s=r.s,!r.c||r.e>_?g.c=g.e=null:r.e<b?g.c=[g.e=0]:(g.e=r.e,g.c=r.c.slice());return}if((u=typeof r=="number")&&r*0==0){if(g.s=1/r<0?(r=-r,-1):1,r===~~r){for(p=0,y=r;y>=10;y/=10,p++);p>_?g.c=g.e=null:(g.e=p,g.c=[r]);return}m=String(r)}else{if(!Qt.test(m=String(r)))return s(g,m,u);g.s=m.charCodeAt(0)==45?(m=m.slice(1),-1):1}(p=m.indexOf("."))>-1&&(m=m.replace(".","")),(y=m.search(/e/i))>0?(p<0&&(p=y),p+=+m.slice(y+1),m=m.substring(0,y)):p<0&&(p=m.length)}else{if(C(o,2,k.length,"Base"),o==10&&ve)return g=new S(r),$(g,x+g.e+1,h);if(m=String(r),u=typeof r=="number"){if(r*0!=0)return s(g,m,u,o);if(g.s=1/r<0?(m=m.slice(1),-1):1,S.DEBUG&&m.replace(/^0\.0*|\./,"").length>15)throw Error(Ye+r)}else g.s=m.charCodeAt(0)===45?(m=m.slice(1),-1):1;for(l=k.slice(0,o),p=y=0,f=m.length;y<f;y++)if(l.indexOf(d=m.charAt(y))<0){if(d=="."){if(y>p){p=f;continue}}else if(!c&&(m==m.toUpperCase()&&(m=m.toLowerCase())||m==m.toLowerCase()&&(m=m.toUpperCase()))){c=!0,y=-1,p=0;continue}return s(g,String(r),u,o)}u=!1,m=t(m,o,10,g.s),(p=m.indexOf("."))>-1?m=m.replace(".",""):p=m.length}for(y=0;m.charCodeAt(y)===48;y++);for(f=m.length;m.charCodeAt(--f)===48;);if(m=m.slice(y,++f)){if(f-=y,u&&S.DEBUG&&f>15&&(r>Re||r!==X(r)))throw Error(Ye+g.s*r);if((p=p-y-1)>_)g.c=g.e=null;else if(p<b)g.c=[g.e=0];else{if(g.e=p,g.c=[],y=(p+1)%P,p<0&&(y+=P),y<f){for(y&&g.c.push(+m.slice(0,y)),f-=P;y<f;)g.c.push(+m.slice(y,y+=P));y=P-(m=m.slice(y)).length}else y-=f;for(;y--;m+="0");g.c.push(+m)}}else g.c=[g.e=0]}S.clone=ot,S.ROUND_UP=0,S.ROUND_DOWN=1,S.ROUND_CEIL=2,S.ROUND_FLOOR=3,S.ROUND_HALF_UP=4,S.ROUND_HALF_DOWN=5,S.ROUND_HALF_EVEN=6,S.ROUND_HALF_CEIL=7,S.ROUND_HALF_FLOOR=8,S.EUCLID=9,S.config=S.set=function(r){var o,l;if(r!=null)if(typeof r=="object"){if(r.hasOwnProperty(o="DECIMAL_PLACES")&&(l=r[o],C(l,0,G,o),x=l),r.hasOwnProperty(o="ROUNDING_MODE")&&(l=r[o],C(l,0,8,o),h=l),r.hasOwnProperty(o="EXPONENTIAL_AT")&&(l=r[o],l&&l.pop?(C(l[0],-G,0,o),C(l[1],0,G,o),E=l[0],w=l[1]):(C(l,-G,G,o),E=-(w=l<0?-l:l))),r.hasOwnProperty(o="RANGE"))if(l=r[o],l&&l.pop)C(l[0],-G,-1,o),C(l[1],1,G,o),b=l[0],_=l[1];else if(C(l,-G,G,o),l)b=-(_=l<0?-l:l);else throw Error(V+o+" cannot be zero: "+l);if(r.hasOwnProperty(o="CRYPTO"))if(l=r[o],l===!!l)if(l)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))I=l;else throw I=!l,Error(V+"crypto unavailable");else I=l;else throw Error(V+o+" not true or false: "+l);if(r.hasOwnProperty(o="MODULO_MODE")&&(l=r[o],C(l,0,9,o),N=l),r.hasOwnProperty(o="POW_PRECISION")&&(l=r[o],C(l,0,G,o),D=l),r.hasOwnProperty(o="FORMAT"))if(l=r[o],typeof l=="object")z=l;else throw Error(V+o+" not an object: "+l);if(r.hasOwnProperty(o="ALPHABET"))if(l=r[o],typeof l=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(l))ve=l.slice(0,10)=="0123456789",k=l;else throw Error(V+o+" invalid: "+l)}else throw Error(V+"Object expected: "+r);return{DECIMAL_PLACES:x,ROUNDING_MODE:h,EXPONENTIAL_AT:[E,w],RANGE:[b,_],CRYPTO:I,MODULO_MODE:N,POW_PRECISION:D,FORMAT:z,ALPHABET:k}},S.isBigNumber=function(r){if(!r||r._isBigNumber!==!0)return!1;if(!S.DEBUG)return!0;var o,l,d=r.c,c=r.e,p=r.s;e:if({}.toString.call(d)=="[object Array]"){if((p===1||p===-1)&&c>=-G&&c<=G&&c===X(c)){if(d[0]===0){if(c===0&&d.length===1)return!0;break e}if(o=(c+1)%P,o<1&&(o+=P),String(d[0]).length==o){for(o=0;o<d.length;o++)if(l=d[o],l<0||l>=K||l!==X(l))break e;if(l!==0)return!0}}}else if(d===null&&c===null&&(p===null||p===1||p===-1))return!0;throw Error(V+"Invalid BigNumber: "+r)},S.maximum=S.max=function(){return ze(arguments,-1)},S.minimum=S.min=function(){return ze(arguments,1)},S.random=(function(){var r=9007199254740992,o=Math.random()*r&2097151?function(){return X(Math.random()*r)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(l){var d,c,p,y,u,f=0,m=[],g=new S(a);if(l==null?l=x:C(l,0,G),y=Me(l/P),I)if(crypto.getRandomValues){for(d=crypto.getRandomValues(new Uint32Array(y*=2));f<y;)u=d[f]*131072+(d[f+1]>>>11),u>=9e15?(c=crypto.getRandomValues(new Uint32Array(2)),d[f]=c[0],d[f+1]=c[1]):(m.push(u%1e14),f+=2);f=y/2}else if(crypto.randomBytes){for(d=crypto.randomBytes(y*=7);f<y;)u=(d[f]&31)*281474976710656+d[f+1]*1099511627776+d[f+2]*4294967296+d[f+3]*16777216+(d[f+4]<<16)+(d[f+5]<<8)+d[f+6],u>=9e15?crypto.randomBytes(7).copy(d,f):(m.push(u%1e14),f+=7);f=y/7}else throw I=!1,Error(V+"crypto unavailable");if(!I)for(;f<y;)u=o(),u<9e15&&(m[f++]=u%1e14);for(y=m[--f],l%=P,y&&l&&(u=Le[P-l],m[f]=X(y/u)*u);m[f]===0;m.pop(),f--);if(f<0)m=[p=0];else{for(p=-1;m[0]===0;m.splice(0,1),p-=P);for(f=1,u=m[0];u>=10;u/=10,f++);f<P&&(p-=P-f)}return g.e=p,g.c=m,g}})(),S.sum=function(){for(var r=1,o=arguments,l=new S(o[0]);r<o.length;)l=l.plus(o[r++]);return l},t=(function(){var r="0123456789";function o(l,d,c,p){for(var y,u=[0],f,m=0,g=l.length;m<g;){for(f=u.length;f--;u[f]*=d);for(u[0]+=p.indexOf(l.charAt(m++)),y=0;y<u.length;y++)u[y]>c-1&&(u[y+1]==null&&(u[y+1]=0),u[y+1]+=u[y]/c|0,u[y]%=c)}return u.reverse()}return function(l,d,c,p,y){var u,f,m,g,v,T,O,R,A=l.indexOf("."),F=x,M=h;for(A>=0&&(g=D,D=0,l=l.replace(".",""),R=new S(d),T=R.pow(l.length-A),D=g,R.c=o(ee(H(T.c),T.e,"0"),10,c,r),R.e=R.c.length),O=o(l,d,c,y?(u=k,r):(u=r,k)),m=g=O.length;O[--g]==0;O.pop());if(!O[0])return u.charAt(0);if(A<0?--m:(T.c=O,T.e=m,T.s=p,T=e(T,R,F,M,c),O=T.c,v=T.r,m=T.e),f=m+F+1,A=O[f],g=c/2,v=v||f<0||O[f+1]!=null,v=M<4?(A!=null||v)&&(M==0||M==(T.s<0?3:2)):A>g||A==g&&(M==4||v||M==6&&O[f-1]&1||M==(T.s<0?8:7)),f<1||!O[0])l=v?ee(u.charAt(1),-F,u.charAt(0)):u.charAt(0);else{if(O.length=f,v)for(--c;++O[--f]>c;)O[f]=0,f||(++m,O=[1].concat(O));for(g=O.length;!O[--g];);for(A=0,l="";A<=g;l+=u.charAt(O[A++]));l=ee(l,m,u.charAt(0))}return l}})(),e=(function(){function r(d,c,p){var y,u,f,m,g=0,v=d.length,T=c%ne,O=c/ne|0;for(d=d.slice();v--;)f=d[v]%ne,m=d[v]/ne|0,y=O*f+m*T,u=T*f+y%ne*ne+g,g=(u/p|0)+(y/ne|0)+O*m,d[v]=u%p;return g&&(d=[g].concat(d)),d}function o(d,c,p,y){var u,f;if(p!=y)f=p>y?1:-1;else for(u=f=0;u<p;u++)if(d[u]!=c[u]){f=d[u]>c[u]?1:-1;break}return f}function l(d,c,p,y){for(var u=0;p--;)d[p]-=u,u=d[p]<c[p]?1:0,d[p]=u*y+d[p]-c[p];for(;!d[0]&&d.length>1;d.splice(0,1));}return function(d,c,p,y,u){var f,m,g,v,T,O,R,A,F,M,L,q,fe,Te,be,Y,se,j=d.s==c.s?1:-1,U=d.c,B=c.c;if(!U||!U[0]||!B||!B[0])return new S(!d.s||!c.s||(U?B&&U[0]==B[0]:!B)?NaN:U&&U[0]==0||!B?j*0:j/0);for(A=new S(j),F=A.c=[],m=d.e-c.e,j=p+m+1,u||(u=K,m=Z(d.e/P)-Z(c.e/P),j=j/P|0),g=0;B[g]==(U[g]||0);g++);if(B[g]>(U[g]||0)&&m--,j<0)F.push(1),v=!0;else{for(Te=U.length,Y=B.length,g=0,j+=2,T=X(u/(B[0]+1)),T>1&&(B=r(B,T,u),U=r(U,T,u),Y=B.length,Te=U.length),fe=Y,M=U.slice(0,Y),L=M.length;L<Y;M[L++]=0);se=B.slice(),se=[0].concat(se),be=B[0],B[1]>=u/2&&be++;do{if(T=0,f=o(B,M,Y,L),f<0){if(q=M[0],Y!=L&&(q=q*u+(M[1]||0)),T=X(q/be),T>1)for(T>=u&&(T=u-1),O=r(B,T,u),R=O.length,L=M.length;o(O,M,R,L)==1;)T--,l(O,Y<R?se:B,R,u),R=O.length,f=1;else T==0&&(f=T=1),O=B.slice(),R=O.length;if(R<L&&(O=[0].concat(O)),l(M,O,L,u),L=M.length,f==-1)for(;o(B,M,Y,L)<1;)T++,l(M,Y<L?se:B,L,u),L=M.length}else f===0&&(T++,M=[0]);F[g++]=T,M[0]?M[L++]=U[fe]||0:(M=[U[fe]],L=1)}while((fe++<Te||M[0]!=null)&&j--);v=M[0]!=null,F[0]||F.splice(0,1)}if(u==K){for(g=1,j=F[0];j>=10;j/=10,g++);$(A,p+(A.e=g+m*P-1)+1,y,v)}else A.e=m,A.r=+v;return A}})();function Se(r,o,l,d){var c,p,y,u,f;if(l==null?l=h:C(l,0,8),!r.c)return r.toString();if(c=r.c[0],y=r.e,o==null)f=H(r.c),f=d==1||d==2&&(y<=E||y>=w)?ge(f,y):ee(f,y,"0");else if(r=$(new S(r),o,l),p=r.e,f=H(r.c),u=f.length,d==1||d==2&&(o<=p||p<=E)){for(;u<o;f+="0",u++);f=ge(f,p)}else if(o-=y+(d===2&&p>y),f=ee(f,p,"0"),p+1>u){if(--o>0)for(f+=".";o--;f+="0");}else if(o+=p-u,o>0)for(p+1==u&&(f+=".");o--;f+="0");return r.s<0&&c?"-"+f:f}function ze(r,o){for(var l,d,c=1,p=new S(r[0]);c<r.length;c++)d=new S(r[c]),(!d.s||(l=ie(p,d))===o||l===0&&p.s===o)&&(p=d);return p}function _e(r,o,l){for(var d=1,c=o.length;!o[--c];o.pop());for(c=o[0];c>=10;c/=10,d++);return(l=d+l*P-1)>_?r.c=r.e=null:l<b?r.c=[r.e=0]:(r.e=l,r.c=o),r}s=(function(){var r=/^(-?)0([xbo])(?=\w[\w.]*$)/i,o=/^([^.]+)\.$/,l=/^\.([^.]+)$/,d=/^-?(Infinity|NaN)$/,c=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(p,y,u,f){var m,g=u?y:y.replace(c,"");if(d.test(g))p.s=isNaN(g)?null:g<0?-1:1;else{if(!u&&(g=g.replace(r,function(v,T,O){return m=(O=O.toLowerCase())=="x"?16:O=="b"?2:8,!f||f==m?T:v}),f&&(m=f,g=g.replace(o,"$1").replace(l,"0.$1")),y!=g))return new S(g,m);if(S.DEBUG)throw Error(V+"Not a"+(f?" base "+f:"")+" number: "+y);p.s=null}p.c=p.e=null}})();function $(r,o,l,d){var c,p,y,u,f,m,g,v=r.c,T=Le;if(v){e:{for(c=1,u=v[0];u>=10;u/=10,c++);if(p=o-c,p<0)p+=P,y=o,f=v[m=0],g=X(f/T[c-y-1]%10);else if(m=Me((p+1)/P),m>=v.length)if(d){for(;v.length<=m;v.push(0));f=g=0,c=1,p%=P,y=p-P+1}else break e;else{for(f=u=v[m],c=1;u>=10;u/=10,c++);p%=P,y=p-P+c,g=y<0?0:X(f/T[c-y-1]%10)}if(d=d||o<0||v[m+1]!=null||(y<0?f:f%T[c-y-1]),d=l<4?(g||d)&&(l==0||l==(r.s<0?3:2)):g>5||g==5&&(l==4||d||l==6&&(p>0?y>0?f/T[c-y]:0:v[m-1])%10&1||l==(r.s<0?8:7)),o<1||!v[0])return v.length=0,d?(o-=r.e+1,v[0]=T[(P-o%P)%P],r.e=-o||0):v[0]=r.e=0,r;if(p==0?(v.length=m,u=1,m--):(v.length=m+1,u=T[P-p],v[m]=y>0?X(f/T[c-y]%T[y])*u:0),d)for(;;)if(m==0){for(p=1,y=v[0];y>=10;y/=10,p++);for(y=v[0]+=u,u=1;y>=10;y/=10,u++);p!=u&&(r.e++,v[0]==K&&(v[0]=1));break}else{if(v[m]+=u,v[m]!=K)break;v[m--]=0,u=1}for(p=v.length;v[--p]===0;v.pop());}r.e>_?r.c=r.e=null:r.e<b&&(r.c=[r.e=0])}return r}function Q(r){var o,l=r.e;return l===null?r.toString():(o=H(r.c),o=l<=E||l>=w?ge(o,l):ee(o,l,"0"),r.s<0?"-"+o:o)}return i.absoluteValue=i.abs=function(){var r=new S(this);return r.s<0&&(r.s=1),r},i.comparedTo=function(r,o){return ie(this,new S(r,o))},i.decimalPlaces=i.dp=function(r,o){var l,d,c,p=this;if(r!=null)return C(r,0,G),o==null?o=h:C(o,0,8),$(new S(p),r+p.e+1,o);if(!(l=p.c))return null;if(d=((c=l.length-1)-Z(this.e/P))*P,c=l[c])for(;c%10==0;c/=10,d--);return d<0&&(d=0),d},i.dividedBy=i.div=function(r,o){return e(this,new S(r,o),x,h)},i.dividedToIntegerBy=i.idiv=function(r,o){return e(this,new S(r,o),0,1)},i.exponentiatedBy=i.pow=function(r,o){var l,d,c,p,y,u,f,m,g,v=this;if(r=new S(r),r.c&&!r.isInteger())throw Error(V+"Exponent not an integer: "+Q(r));if(o!=null&&(o=new S(o)),u=r.e>14,!v.c||!v.c[0]||v.c[0]==1&&!v.e&&v.c.length==1||!r.c||!r.c[0])return g=new S(Math.pow(+Q(v),u?r.s*(2-pe(r)):+Q(r))),o?g.mod(o):g;if(f=r.s<0,o){if(o.c?!o.c[0]:!o.s)return new S(NaN);d=!f&&v.isInteger()&&o.isInteger(),d&&(v=v.mod(o))}else{if(r.e>9&&(v.e>0||v.e<-1||(v.e==0?v.c[0]>1||u&&v.c[1]>=24e7:v.c[0]<8e13||u&&v.c[0]<=9999975e7)))return p=v.s<0&&pe(r)?-0:0,v.e>-1&&(p=1/p),new S(f?1/p:p);D&&(p=Me(D/P+2))}for(u?(l=new S(.5),f&&(r.s=1),m=pe(r)):(c=Math.abs(+Q(r)),m=c%2),g=new S(a);;){if(m){if(g=g.times(v),!g.c)break;p?g.c.length>p&&(g.c.length=p):d&&(g=g.mod(o))}if(c){if(c=X(c/2),c===0)break;m=c%2}else if(r=r.times(l),$(r,r.e+1,1),r.e>14)m=pe(r);else{if(c=+Q(r),c===0)break;m=c%2}v=v.times(v),p?v.c&&v.c.length>p&&(v.c.length=p):d&&(v=v.mod(o))}return d?g:(f&&(g=a.div(g)),o?g.mod(o):p?$(g,D,h,y):g)},i.integerValue=function(r){var o=new S(this);return r==null?r=h:C(r,0,8),$(o,o.e+1,r)},i.isEqualTo=i.eq=function(r,o){return ie(this,new S(r,o))===0},i.isFinite=function(){return!!this.c},i.isGreaterThan=i.gt=function(r,o){return ie(this,new S(r,o))>0},i.isGreaterThanOrEqualTo=i.gte=function(r,o){return(o=ie(this,new S(r,o)))===1||o===0},i.isInteger=function(){return!!this.c&&Z(this.e/P)>this.c.length-2},i.isLessThan=i.lt=function(r,o){return ie(this,new S(r,o))<0},i.isLessThanOrEqualTo=i.lte=function(r,o){return(o=ie(this,new S(r,o)))===-1||o===0},i.isNaN=function(){return!this.s},i.isNegative=function(){return this.s<0},i.isPositive=function(){return this.s>0},i.isZero=function(){return!!this.c&&this.c[0]==0},i.minus=function(r,o){var l,d,c,p,y=this,u=y.s;if(r=new S(r,o),o=r.s,!u||!o)return new S(NaN);if(u!=o)return r.s=-o,y.plus(r);var f=y.e/P,m=r.e/P,g=y.c,v=r.c;if(!f||!m){if(!g||!v)return g?(r.s=-o,r):new S(v?y:NaN);if(!g[0]||!v[0])return v[0]?(r.s=-o,r):new S(g[0]?y:h==3?-0:0)}if(f=Z(f),m=Z(m),g=g.slice(),u=f-m){for((p=u<0)?(u=-u,c=g):(m=f,c=v),c.reverse(),o=u;o--;c.push(0));c.reverse()}else for(d=(p=(u=g.length)<(o=v.length))?u:o,u=o=0;o<d;o++)if(g[o]!=v[o]){p=g[o]<v[o];break}if(p&&(c=g,g=v,v=c,r.s=-r.s),o=(d=v.length)-(l=g.length),o>0)for(;o--;g[l++]=0);for(o=K-1;d>u;){if(g[--d]<v[d]){for(l=d;l&&!g[--l];g[l]=o);--g[l],g[d]+=K}g[d]-=v[d]}for(;g[0]==0;g.splice(0,1),--m);return g[0]?_e(r,g,m):(r.s=h==3?-1:1,r.c=[r.e=0],r)},i.modulo=i.mod=function(r,o){var l,d,c=this;return r=new S(r,o),!c.c||!r.s||r.c&&!r.c[0]?new S(NaN):!r.c||c.c&&!c.c[0]?new S(c):(N==9?(d=r.s,r.s=1,l=e(c,r,0,3),r.s=d,l.s*=d):l=e(c,r,0,N),r=c.minus(l.times(r)),!r.c[0]&&N==1&&(r.s=c.s),r)},i.multipliedBy=i.times=function(r,o){var l,d,c,p,y,u,f,m,g,v,T,O,R,A,F,M=this,L=M.c,q=(r=new S(r,o)).c;if(!L||!q||!L[0]||!q[0])return!M.s||!r.s||L&&!L[0]&&!q||q&&!q[0]&&!L?r.c=r.e=r.s=null:(r.s*=M.s,!L||!q?r.c=r.e=null:(r.c=[0],r.e=0)),r;for(d=Z(M.e/P)+Z(r.e/P),r.s*=M.s,f=L.length,v=q.length,f<v&&(R=L,L=q,q=R,c=f,f=v,v=c),c=f+v,R=[];c--;R.push(0));for(A=K,F=ne,c=v;--c>=0;){for(l=0,T=q[c]%F,O=q[c]/F|0,y=f,p=c+y;p>c;)m=L[--y]%F,g=L[y]/F|0,u=O*m+g*T,m=T*m+u%F*F+R[p]+l,l=(m/A|0)+(u/F|0)+O*g,R[p--]=m%A;R[p]=l}return l?++d:R.splice(0,1),_e(r,R,d)},i.negated=function(){var r=new S(this);return r.s=-r.s||null,r},i.plus=function(r,o){var l,d=this,c=d.s;if(r=new S(r,o),o=r.s,!c||!o)return new S(NaN);if(c!=o)return r.s=-o,d.minus(r);var p=d.e/P,y=r.e/P,u=d.c,f=r.c;if(!p||!y){if(!u||!f)return new S(c/0);if(!u[0]||!f[0])return f[0]?r:new S(u[0]?d:c*0)}if(p=Z(p),y=Z(y),u=u.slice(),c=p-y){for(c>0?(y=p,l=f):(c=-c,l=u),l.reverse();c--;l.push(0));l.reverse()}for(c=u.length,o=f.length,c-o<0&&(l=f,f=u,u=l,o=c),c=0;o;)c=(u[--o]=u[o]+f[o]+c)/K|0,u[o]=K===u[o]?0:u[o]%K;return c&&(u=[c].concat(u),++y),_e(r,u,y)},i.precision=i.sd=function(r,o){var l,d,c,p=this;if(r!=null&&r!==!!r)return C(r,1,G),o==null?o=h:C(o,0,8),$(new S(p),r,o);if(!(l=p.c))return null;if(c=l.length-1,d=c*P+1,c=l[c]){for(;c%10==0;c/=10,d--);for(c=l[0];c>=10;c/=10,d++);}return r&&p.e+1>d&&(d=p.e+1),d},i.shiftedBy=function(r){return C(r,-Re,Re),this.times("1e"+r)},i.squareRoot=i.sqrt=function(){var r,o,l,d,c,p=this,y=p.c,u=p.s,f=p.e,m=x+4,g=new S("0.5");if(u!==1||!y||!y[0])return new S(!u||u<0&&(!y||y[0])?NaN:y?p:1/0);if(u=Math.sqrt(+Q(p)),u==0||u==1/0?(o=H(y),(o.length+f)%2==0&&(o+="0"),u=Math.sqrt(+o),f=Z((f+1)/2)-(f<0||f%2),u==1/0?o="5e"+f:(o=u.toExponential(),o=o.slice(0,o.indexOf("e")+1)+f),l=new S(o)):l=new S(u+""),l.c[0]){for(f=l.e,u=f+m,u<3&&(u=0);;)if(c=l,l=g.times(c.plus(e(p,c,m,1))),H(c.c).slice(0,u)===(o=H(l.c)).slice(0,u))if(l.e<f&&--u,o=o.slice(u-3,u+1),o=="9999"||!d&&o=="4999"){if(!d&&($(c,c.e+x+2,0),c.times(c).eq(p))){l=c;break}m+=4,u+=4,d=1}else{(!+o||!+o.slice(1)&&o.charAt(0)=="5")&&($(l,l.e+x+2,1),r=!l.times(l).eq(p));break}}return $(l,l.e+x+1,h,r)},i.toExponential=function(r,o){return r!=null&&(C(r,0,G),r++),Se(this,r,o,1)},i.toFixed=function(r,o){return r!=null&&(C(r,0,G),r=r+this.e+1),Se(this,r,o)},i.toFormat=function(r,o,l){var d,c=this;if(l==null)r!=null&&o&&typeof o=="object"?(l=o,o=null):r&&typeof r=="object"?(l=r,r=o=null):l=z;else if(typeof l!="object")throw Error(V+"Argument not an object: "+l);if(d=c.toFixed(r,o),c.c){var p,y=d.split("."),u=+l.groupSize,f=+l.secondaryGroupSize,m=l.groupSeparator||"",g=y[0],v=y[1],T=c.s<0,O=T?g.slice(1):g,R=O.length;if(f&&(p=u,u=f,f=p,R-=p),u>0&&R>0){for(p=R%u||u,g=O.substr(0,p);p<R;p+=u)g+=m+O.substr(p,u);f>0&&(g+=m+O.slice(p)),T&&(g="-"+g)}d=v?g+(l.decimalSeparator||"")+((f=+l.fractionGroupSize)?v.replace(new RegExp("\\d{"+f+"}\\B","g"),"$&"+(l.fractionGroupSeparator||"")):v):g}return(l.prefix||"")+d+(l.suffix||"")},i.toFraction=function(r){var o,l,d,c,p,y,u,f,m,g,v,T,O=this,R=O.c;if(r!=null&&(u=new S(r),!u.isInteger()&&(u.c||u.s!==1)||u.lt(a)))throw Error(V+"Argument "+(u.isInteger()?"out of range: ":"not an integer: ")+Q(u));if(!R)return new S(O);for(o=new S(a),m=l=new S(a),d=f=new S(a),T=H(R),p=o.e=T.length-O.e-1,o.c[0]=Le[(y=p%P)<0?P+y:y],r=!r||u.comparedTo(o)>0?p>0?o:m:u,y=_,_=1/0,u=new S(T),f.c[0]=0;g=e(u,o,0,1),c=l.plus(g.times(d)),c.comparedTo(r)!=1;)l=d,d=c,m=f.plus(g.times(c=m)),f=c,o=u.minus(g.times(c=o)),u=c;return c=e(r.minus(l),d,0,1),f=f.plus(c.times(m)),l=l.plus(c.times(d)),f.s=m.s=O.s,p=p*2,v=e(m,d,p,h).minus(O).abs().comparedTo(e(f,l,p,h).minus(O).abs())<1?[m,d]:[f,l],_=y,v},i.toNumber=function(){return+Q(this)},i.toPrecision=function(r,o){return r!=null&&C(r,1,G),Se(this,r,o,2)},i.toString=function(r){var o,l=this,d=l.s,c=l.e;return c===null?d?(o="Infinity",d<0&&(o="-"+o)):o="NaN":(r==null?o=c<=E||c>=w?ge(H(l.c),c):ee(H(l.c),c,"0"):r===10&&ve?(l=$(new S(l),x+c+1,h),o=ee(H(l.c),l.e,"0")):(C(r,2,k.length,"Base"),o=t(ee(H(l.c),c,"0"),10,r,d,!0)),d<0&&l.c[0]&&(o="-"+o)),o},i.valueOf=i.toJSON=function(){return Q(this)},i._isBigNumber=!0,i[Symbol.toStringTag]="BigNumber",i[Symbol.for("nodejs.util.inspect.custom")]=i.valueOf,n!=null&&S.set(n),S}function Z(n){var e=n|0;return n>0||n===e?e:e-1}function H(n){for(var e,t,s=1,i=n.length,a=n[0]+"";s<i;){for(e=n[s++]+"",t=P-e.length;t--;e="0"+e);a+=e}for(i=a.length;a.charCodeAt(--i)===48;);return a.slice(0,i+1||1)}function ie(n,e){var t,s,i=n.c,a=e.c,x=n.s,h=e.s,E=n.e,w=e.e;if(!x||!h)return null;if(t=i&&!i[0],s=a&&!a[0],t||s)return t?s?0:-h:x;if(x!=h)return x;if(t=x<0,s=E==w,!i||!a)return s?0:!i^t?1:-1;if(!s)return E>w^t?1:-1;for(h=(E=i.length)<(w=a.length)?E:w,x=0;x<h;x++)if(i[x]!=a[x])return i[x]>a[x]^t?1:-1;return E==w?0:E>w^t?1:-1}function C(n,e,t,s){if(n<e||n>t||n!==X(n))throw Error(V+(s||"Argument")+(typeof n=="number"?n<e||n>t?" out of range: ":" not an integer: ":" not a primitive number: ")+String(n))}function pe(n){var e=n.c.length-1;return Z(n.e/P)==e&&n.c[e]%2!=0}function ge(n,e){return(n.length>1?n.charAt(0)+"."+n.slice(1):n)+(e<0?"e":"e+")+e}function ee(n,e,t){var s,i;if(e<0){for(i=t+".";++e;i+=t);n=i+n}else if(s=n.length,++e>s){for(i=t,e-=s;--e;i+=t);n+=i}else e<s&&(n=n.slice(0,e)+"."+n.slice(e));return n}var W=ot(),en=class{key;left=null;right=null;constructor(n){this.key=n}},oe=class extends en{constructor(n){super(n)}},tn=class{size=0;modificationCount=0;splayCount=0;splay(n){const e=this.root;if(e==null)return this.compare(n,n),-1;let t=null,s=null,i=null,a=null,x=e;const h=this.compare;let E;for(;;)if(E=h(x.key,n),E>0){let w=x.left;if(w==null||(E=h(w.key,n),E>0&&(x.left=w.right,w.right=x,x=w,w=x.left,w==null)))break;t==null?s=x:t.left=x,t=x,x=w}else if(E<0){let w=x.right;if(w==null||(E=h(w.key,n),E<0&&(x.right=w.left,w.left=x,x=w,w=x.right,w==null)))break;i==null?a=x:i.right=x,i=x,x=w}else break;return i!=null&&(i.right=x.left,x.left=a),t!=null&&(t.left=x.right,x.right=s),this.root!==x&&(this.root=x,this.splayCount++),E}splayMin(n){let e=n,t=e.left;for(;t!=null;){const s=t;e.left=s.right,s.right=e,e=s,t=e.left}return e}splayMax(n){let e=n,t=e.right;for(;t!=null;){const s=t;e.right=s.left,s.left=e,e=s,t=e.right}return e}_delete(n){if(this.root==null||this.splay(n)!=0)return null;let t=this.root;const s=t,i=t.left;if(this.size--,i==null)this.root=t.right;else{const a=t.right;t=this.splayMax(i),t.right=a,this.root=t}return this.modificationCount++,s}addNewRoot(n,e){this.size++,this.modificationCount++;const t=this.root;if(t==null){this.root=n;return}e<0?(n.left=t,n.right=t.right,t.right=null):(n.right=t,n.left=t.left,t.left=null),this.root=n}_first(){const n=this.root;return n==null?null:(this.root=this.splayMin(n),this.root)}_last(){const n=this.root;return n==null?null:(this.root=this.splayMax(n),this.root)}clear(){this.root=null,this.size=0,this.modificationCount++}has(n){return this.validKey(n)&&this.splay(n)==0}defaultCompare(){return(n,e)=>n<e?-1:n>e?1:0}wrap(){return{getRoot:()=>this.root,setRoot:n=>{this.root=n},getSize:()=>this.size,getModificationCount:()=>this.modificationCount,getSplayCount:()=>this.splayCount,setSplayCount:n=>{this.splayCount=n},splay:n=>this.splay(n),has:n=>this.has(n)}}},ye=class ue extends tn{root=null;compare;validKey;constructor(e,t){super(),this.compare=e??this.defaultCompare(),this.validKey=t??(s=>s!=null&&s!=null)}delete(e){return this.validKey(e)?this._delete(e)!=null:!1}deleteAll(e){for(const t of e)this.delete(t)}forEach(e){const t=this[Symbol.iterator]();let s;for(;s=t.next(),!s.done;)e(s.value,s.value,this)}add(e){const t=this.splay(e);return t!=0&&this.addNewRoot(new oe(e),t),this}addAndReturn(e){const t=this.splay(e);return t!=0&&this.addNewRoot(new oe(e),t),this.root.key}addAll(e){for(const t of e)this.add(t)}isEmpty(){return this.root==null}isNotEmpty(){return this.root!=null}single(){if(this.size==0)throw"Bad state: No element";if(this.size>1)throw"Bad state: Too many element";return this.root.key}first(){if(this.size==0)throw"Bad state: No element";return this._first().key}last(){if(this.size==0)throw"Bad state: No element";return this._last().key}lastBefore(e){if(e==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(e)<0)return this.root.key;let s=this.root.left;if(s==null)return null;let i=s.right;for(;i!=null;)s=i,i=s.right;return s.key}firstAfter(e){if(e==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(e)>0)return this.root.key;let s=this.root.right;if(s==null)return null;let i=s.left;for(;i!=null;)s=i,i=s.left;return s.key}retainAll(e){const t=new ue(this.compare,this.validKey),s=this.modificationCount;for(const i of e){if(s!=this.modificationCount)throw"Concurrent modification during iteration.";this.validKey(i)&&this.splay(i)==0&&t.add(this.root.key)}t.size!=this.size&&(this.root=t.root,this.size=t.size,this.modificationCount++)}lookup(e){return!this.validKey(e)||this.splay(e)!=0?null:this.root.key}intersection(e){const t=new ue(this.compare,this.validKey);for(const s of this)e.has(s)&&t.add(s);return t}difference(e){const t=new ue(this.compare,this.validKey);for(const s of this)e.has(s)||t.add(s);return t}union(e){const t=this.clone();return t.addAll(e),t}clone(){const e=new ue(this.compare,this.validKey);return e.size=this.size,e.root=this.copyNode(this.root),e}copyNode(e){if(e==null)return null;function t(i,a){let x,h;do{if(x=i.left,h=i.right,x!=null){const E=new oe(x.key);a.left=E,t(x,E)}if(h!=null){const E=new oe(h.key);a.right=E,i=h,a=E}}while(h!=null)}const s=new oe(e.key);return t(e,s),s}toSet(){return this.clone()}entries(){return new rn(this.wrap())}keys(){return this[Symbol.iterator]()}values(){return this[Symbol.iterator]()}[Symbol.iterator](){return new nn(this.wrap())}[Symbol.toStringTag]="[object Set]"},lt=class{tree;path=new Array;modificationCount=null;splayCount;constructor(n){this.tree=n,this.splayCount=n.getSplayCount()}[Symbol.iterator](){return this}next(){return this.moveNext()?{done:!1,value:this.current()}:{done:!0,value:null}}current(){if(!this.path.length)return null;const n=this.path[this.path.length-1];return this.getValue(n)}rebuildPath(n){this.path.splice(0,this.path.length),this.tree.splay(n),this.path.push(this.tree.getRoot()),this.splayCount=this.tree.getSplayCount()}findLeftMostDescendent(n){for(;n!=null;)this.path.push(n),n=n.left}moveNext(){if(this.modificationCount!=this.tree.getModificationCount()){if(this.modificationCount==null){this.modificationCount=this.tree.getModificationCount();let t=this.tree.getRoot();for(;t!=null;)this.path.push(t),t=t.left;return this.path.length>0}throw"Concurrent modification during iteration."}if(!this.path.length)return!1;this.splayCount!=this.tree.getSplayCount()&&this.rebuildPath(this.path[this.path.length-1].key);let n=this.path[this.path.length-1],e=n.right;if(e!=null){for(;e!=null;)this.path.push(e),e=e.left;return!0}for(this.path.pop();this.path.length&&this.path[this.path.length-1].right===n;)n=this.path.pop();return this.path.length>0}},nn=class extends lt{getValue(n){return n.key}},rn=class extends lt{getValue(n){return[n.key,n.key]}},ut=n=>()=>n,Be=n=>{const e=n?(t,s)=>s.minus(t).abs().isLessThanOrEqualTo(n):ut(!1);return(t,s)=>e(t,s)?0:t.comparedTo(s)};function sn(n){const e=n?(t,s,i,a,x)=>t.exponentiatedBy(2).isLessThanOrEqualTo(a.minus(s).exponentiatedBy(2).plus(x.minus(i).exponentiatedBy(2)).times(n)):ut(!1);return(t,s,i)=>{const a=t.x,x=t.y,h=i.x,E=i.y,w=x.minus(E).times(s.x.minus(h)).minus(a.minus(h).times(s.y.minus(E)));return e(w,a,x,h,E)?0:w.comparedTo(0)}}var on=n=>n,ln=n=>{if(n){const e=new ye(Be(n)),t=new ye(Be(n)),s=(a,x)=>x.addAndReturn(a),i=a=>({x:s(a.x,e),y:s(a.y,t)});return i({x:new W(0),y:new W(0)}),i}return on},Fe=n=>({set:e=>{te=Fe(e)},reset:()=>Fe(n),compare:Be(n),snap:ln(n),orient:sn(n)}),te=Fe(),le=(n,e)=>n.ll.x.isLessThanOrEqualTo(e.x)&&e.x.isLessThanOrEqualTo(n.ur.x)&&n.ll.y.isLessThanOrEqualTo(e.y)&&e.y.isLessThanOrEqualTo(n.ur.y),Ge=(n,e)=>{if(e.ur.x.isLessThan(n.ll.x)||n.ur.x.isLessThan(e.ll.x)||e.ur.y.isLessThan(n.ll.y)||n.ur.y.isLessThan(e.ll.y))return null;const t=n.ll.x.isLessThan(e.ll.x)?e.ll.x:n.ll.x,s=n.ur.x.isLessThan(e.ur.x)?n.ur.x:e.ur.x,i=n.ll.y.isLessThan(e.ll.y)?e.ll.y:n.ll.y,a=n.ur.y.isLessThan(e.ur.y)?n.ur.y:e.ur.y;return{ll:{x:t,y:i},ur:{x:s,y:a}}},xe=(n,e)=>n.x.times(e.y).minus(n.y.times(e.x)),at=(n,e)=>n.x.times(e.x).plus(n.y.times(e.y)),we=n=>at(n,n).sqrt(),un=(n,e,t)=>{const s={x:e.x.minus(n.x),y:e.y.minus(n.y)},i={x:t.x.minus(n.x),y:t.y.minus(n.y)};return xe(i,s).div(we(i)).div(we(s))},an=(n,e,t)=>{const s={x:e.x.minus(n.x),y:e.y.minus(n.y)},i={x:t.x.minus(n.x),y:t.y.minus(n.y)};return at(i,s).div(we(i)).div(we(s))},Je=(n,e,t)=>e.y.isZero()?null:{x:n.x.plus(e.x.div(e.y).times(t.minus(n.y))),y:t},We=(n,e,t)=>e.x.isZero()?null:{x:t,y:n.y.plus(e.y.div(e.x).times(t.minus(n.x)))},cn=(n,e,t,s)=>{if(e.x.isZero())return We(t,s,n.x);if(s.x.isZero())return We(n,e,t.x);if(e.y.isZero())return Je(t,s,n.y);if(s.y.isZero())return Je(n,e,t.y);const i=xe(e,s);if(i.isZero())return null;const a={x:t.x.minus(n.x),y:t.y.minus(n.y)},x=xe(a,e).div(i),h=xe(a,s).div(i),E=n.x.plus(h.times(e.x)),w=t.x.plus(x.times(s.x)),b=n.y.plus(h.times(e.y)),_=t.y.plus(x.times(s.y)),I=E.plus(w).div(2),N=b.plus(_).div(2);return{x:I,y:N}},J=class ct{point;isLeft;segment;otherSE;consumedBy;static compare(e,t){const s=ct.comparePoints(e.point,t.point);return s!==0?s:(e.point!==t.point&&e.link(t),e.isLeft!==t.isLeft?e.isLeft?1:-1:Ee.compare(e.segment,t.segment))}static comparePoints(e,t){return e.x.isLessThan(t.x)?-1:e.x.isGreaterThan(t.x)?1:e.y.isLessThan(t.y)?-1:e.y.isGreaterThan(t.y)?1:0}constructor(e,t){e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");const t=e.point.events;for(let s=0,i=t.length;s<i;s++){const a=t[s];this.point.events.push(a),a.point=this.point}this.checkForConsuming()}checkForConsuming(){const e=this.point.events.length;for(let t=0;t<e;t++){const s=this.point.events[t];if(s.segment.consumedBy===void 0)for(let i=t+1;i<e;i++){const a=this.point.events[i];a.consumedBy===void 0&&s.otherSE.point.events===a.otherSE.point.events&&s.segment.consume(a.segment)}}}getAvailableLinkedEvents(){const e=[];for(let t=0,s=this.point.events.length;t<s;t++){const i=this.point.events[t];i!==this&&!i.segment.ringOut&&i.segment.isInResult()&&e.push(i)}return e}getLeftmostComparator(e){const t=new Map,s=i=>{const a=i.otherSE;t.set(i,{sine:un(this.point,e.point,a.point),cosine:an(this.point,e.point,a.point)})};return(i,a)=>{t.has(i)||s(i),t.has(a)||s(a);const{sine:x,cosine:h}=t.get(i),{sine:E,cosine:w}=t.get(a);return x.isGreaterThanOrEqualTo(0)&&E.isGreaterThanOrEqualTo(0)?h.isLessThan(w)?1:h.isGreaterThan(w)?-1:0:x.isLessThan(0)&&E.isLessThan(0)?h.isLessThan(w)?-1:h.isGreaterThan(w)?1:0:E.isLessThan(x)?-1:E.isGreaterThan(x)?1:0}}},hn=class ke{events;poly;_isExteriorRing;_enclosingRing;static factory(e){const t=[];for(let s=0,i=e.length;s<i;s++){const a=e[s];if(!a.isInResult()||a.ringOut)continue;let x=null,h=a.leftSE,E=a.rightSE;const w=[h],b=h.point,_=[];for(;x=h,h=E,w.push(h),h.point!==b;)for(;;){const I=h.getAvailableLinkedEvents();if(I.length===0){const z=w[0].point,k=w[w.length-1].point;throw new Error(`Unable to complete output ring starting at [${z.x}, ${z.y}]. Last matching segment found ends at [${k.x}, ${k.y}].`)}if(I.length===1){E=I[0].otherSE;break}let N=null;for(let z=0,k=_.length;z<k;z++)if(_[z].point===h.point){N=z;break}if(N!==null){const z=_.splice(N)[0],k=w.splice(z.index);k.unshift(k[0].otherSE),t.push(new ke(k.reverse()));continue}_.push({index:w.length,point:h.point});const D=h.getLeftmostComparator(x);E=I.sort(D)[0].otherSE;break}t.push(new ke(w))}return t}constructor(e){this.events=e;for(let t=0,s=e.length;t<s;t++)e[t].segment.ringOut=this;this.poly=null}getGeom(){let e=this.events[0].point;const t=[e];for(let w=1,b=this.events.length-1;w<b;w++){const _=this.events[w].point,I=this.events[w+1].point;te.orient(_,e,I)!==0&&(t.push(_),e=_)}if(t.length===1)return null;const s=t[0],i=t[1];te.orient(s,e,i)===0&&t.shift(),t.push(t[0]);const a=this.isExteriorRing()?1:-1,x=this.isExteriorRing()?0:t.length-1,h=this.isExteriorRing()?t.length:-1,E=[];for(let w=x;w!=h;w+=a)E.push([t[w].x.toNumber(),t[w].y.toNumber()]);return E}isExteriorRing(){if(this._isExteriorRing===void 0){const e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let e=this.events[0];for(let i=1,a=this.events.length;i<a;i++){const x=this.events[i];J.compare(e,x)>0&&(e=x)}let t=e.segment.prevInResult(),s=t?t.prevInResult():null;for(;;){if(!t)return null;if(!s)return t.ringOut;if(s.ringOut!==t.ringOut)return s.ringOut?.enclosingRing()!==t.ringOut?t.ringOut:t.ringOut?.enclosingRing();t=s.prevInResult(),s=t?t.prevInResult():null}}},Qe=class{exteriorRing;interiorRings;constructor(n){this.exteriorRing=n,n.poly=this,this.interiorRings=[]}addInterior(n){this.interiorRings.push(n),n.poly=this}getGeom(){const n=this.exteriorRing.getGeom();if(n===null)return null;const e=[n];for(let t=0,s=this.interiorRings.length;t<s;t++){const i=this.interiorRings[t].getGeom();i!==null&&e.push(i)}return e}},fn=class{rings;polys;constructor(n){this.rings=n,this.polys=this._composePolys(n)}getGeom(){const n=[];for(let e=0,t=this.polys.length;e<t;e++){const s=this.polys[e].getGeom();s!==null&&n.push(s)}return n}_composePolys(n){const e=[];for(let t=0,s=n.length;t<s;t++){const i=n[t];if(!i.poly)if(i.isExteriorRing())e.push(new Qe(i));else{const a=i.enclosingRing();a?.poly||e.push(new Qe(a)),a?.poly?.addInterior(i)}}return e}},pn=class{queue;tree;segments;constructor(n,e=Ee.compare){this.queue=n,this.tree=new ye(e),this.segments=[]}process(n){const e=n.segment,t=[];if(n.consumedBy)return n.isLeft?this.queue.delete(n.otherSE):this.tree.delete(e),t;n.isLeft&&this.tree.add(e);let s=e,i=e;do s=this.tree.lastBefore(s);while(s!=null&&s.consumedBy!=null);do i=this.tree.firstAfter(i);while(i!=null&&i.consumedBy!=null);if(n.isLeft){let a=null;if(s){const h=s.getIntersection(e);if(h!==null&&(e.isAnEndpoint(h)||(a=h),!s.isAnEndpoint(h))){const E=this._splitSafely(s,h);for(let w=0,b=E.length;w<b;w++)t.push(E[w])}}let x=null;if(i){const h=i.getIntersection(e);if(h!==null&&(e.isAnEndpoint(h)||(x=h),!i.isAnEndpoint(h))){const E=this._splitSafely(i,h);for(let w=0,b=E.length;w<b;w++)t.push(E[w])}}if(a!==null||x!==null){let h=null;a===null?h=x:x===null?h=a:h=J.comparePoints(a,x)<=0?a:x,this.queue.delete(e.rightSE),t.push(e.rightSE);const E=e.split(h);for(let w=0,b=E.length;w<b;w++)t.push(E[w])}t.length>0?(this.tree.delete(e),t.push(n)):(this.segments.push(e),e.prev=s)}else{if(s&&i){const a=s.getIntersection(i);if(a!==null){if(!s.isAnEndpoint(a)){const x=this._splitSafely(s,a);for(let h=0,E=x.length;h<E;h++)t.push(x[h])}if(!i.isAnEndpoint(a)){const x=this._splitSafely(i,a);for(let h=0,E=x.length;h<E;h++)t.push(x[h])}}}this.tree.delete(e)}return t}_splitSafely(n,e){this.tree.delete(n);const t=n.rightSE;this.queue.delete(t);const s=n.split(e);return s.push(t),n.consumedBy===void 0&&this.tree.add(n),s}},gn=class{type;numMultiPolys;run(n,e,t){ae.type=n;const s=[new tt(e,!0)];for(let w=0,b=t.length;w<b;w++)s.push(new tt(t[w],!1));if(ae.numMultiPolys=s.length,ae.type==="difference"){const w=s[0];let b=1;for(;b<s.length;)Ge(s[b].bbox,w.bbox)!==null?b++:s.splice(b,1)}if(ae.type==="intersection")for(let w=0,b=s.length;w<b;w++){const _=s[w];for(let I=w+1,N=s.length;I<N;I++)if(Ge(_.bbox,s[I].bbox)===null)return[]}const i=new ye(J.compare);for(let w=0,b=s.length;w<b;w++){const _=s[w].getSweepEvents();for(let I=0,N=_.length;I<N;I++)i.add(_[I])}const a=new pn(i);let x=null;for(i.size!=0&&(x=i.first(),i.delete(x));x;){const w=a.process(x);for(let b=0,_=w.length;b<_;b++){const I=w[b];I.consumedBy===void 0&&i.add(I)}i.size!=0?(x=i.first(),i.delete(x)):x=null}te.reset();const h=hn.factory(a.segments);return new fn(h).getGeom()}},ae=new gn,re=ae,dn=0,Ee=class me{id;leftSE;rightSE;rings;windings;ringOut;consumedBy;prev;_prevInResult;_beforeState;_afterState;_isInResult;static compare(e,t){const s=e.leftSE.point.x,i=t.leftSE.point.x,a=e.rightSE.point.x,x=t.rightSE.point.x;if(x.isLessThan(s))return 1;if(a.isLessThan(i))return-1;const h=e.leftSE.point.y,E=t.leftSE.point.y,w=e.rightSE.point.y,b=t.rightSE.point.y;if(s.isLessThan(i)){if(E.isLessThan(h)&&E.isLessThan(w))return 1;if(E.isGreaterThan(h)&&E.isGreaterThan(w))return-1;const _=e.comparePoint(t.leftSE.point);if(_<0)return 1;if(_>0)return-1;const I=t.comparePoint(e.rightSE.point);return I!==0?I:-1}if(s.isGreaterThan(i)){if(h.isLessThan(E)&&h.isLessThan(b))return-1;if(h.isGreaterThan(E)&&h.isGreaterThan(b))return 1;const _=t.comparePoint(e.leftSE.point);if(_!==0)return _;const I=e.comparePoint(t.rightSE.point);return I<0?1:I>0?-1:1}if(h.isLessThan(E))return-1;if(h.isGreaterThan(E))return 1;if(a.isLessThan(x)){const _=t.comparePoint(e.rightSE.point);if(_!==0)return _}if(a.isGreaterThan(x)){const _=e.comparePoint(t.rightSE.point);if(_<0)return 1;if(_>0)return-1}if(!a.eq(x)){const _=w.minus(h),I=a.minus(s),N=b.minus(E),D=x.minus(i);if(_.isGreaterThan(I)&&N.isLessThan(D))return 1;if(_.isLessThan(I)&&N.isGreaterThan(D))return-1}return a.isGreaterThan(x)?1:a.isLessThan(x)||w.isLessThan(b)?-1:w.isGreaterThan(b)?1:e.id<t.id?-1:e.id>t.id?1:0}constructor(e,t,s,i){this.id=++dn,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=s,this.windings=i}static fromRing(e,t,s){let i,a,x;const h=J.comparePoints(e,t);if(h<0)i=e,a=t,x=1;else if(h>0)i=t,a=e,x=-1;else throw new Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);const E=new J(i,!0),w=new J(a,!1);return new me(E,w,[s],[x])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const e=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e.isLessThan(t)?e:t},ur:{x:this.rightSE.point.x,y:e.isGreaterThan(t)?e:t}}}vector(){return{x:this.rightSE.point.x.minus(this.leftSE.point.x),y:this.rightSE.point.y.minus(this.leftSE.point.y)}}isAnEndpoint(e){return e.x.eq(this.leftSE.point.x)&&e.y.eq(this.leftSE.point.y)||e.x.eq(this.rightSE.point.x)&&e.y.eq(this.rightSE.point.y)}comparePoint(e){return te.orient(this.leftSE.point,e,this.rightSE.point)}getIntersection(e){const t=this.bbox(),s=e.bbox(),i=Ge(t,s);if(i===null)return null;const a=this.leftSE.point,x=this.rightSE.point,h=e.leftSE.point,E=e.rightSE.point,w=le(t,h)&&this.comparePoint(h)===0,b=le(s,a)&&e.comparePoint(a)===0,_=le(t,E)&&this.comparePoint(E)===0,I=le(s,x)&&e.comparePoint(x)===0;if(b&&w)return I&&!_?x:!I&&_?E:null;if(b)return _&&a.x.eq(E.x)&&a.y.eq(E.y)?null:a;if(w)return I&&x.x.eq(h.x)&&x.y.eq(h.y)?null:h;if(I&&_)return null;if(I)return x;if(_)return E;const N=cn(a,this.vector(),h,e.vector());return N===null||!le(i,N)?null:te.snap(N)}split(e){const t=[],s=e.events!==void 0,i=new J(e,!0),a=new J(e,!1),x=this.rightSE;this.replaceRightSE(a),t.push(a),t.push(i);const h=new me(i,x,this.rings.slice(),this.windings.slice());return J.comparePoints(h.leftSE.point,h.rightSE.point)>0&&h.swapEvents(),J.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),s&&(i.checkForConsuming(),a.checkForConsuming()),t}swapEvents(){const e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let t=0,s=this.windings.length;t<s;t++)this.windings[t]*=-1}consume(e){let t=this,s=e;for(;t.consumedBy;)t=t.consumedBy;for(;s.consumedBy;)s=s.consumedBy;const i=me.compare(t,s);if(i!==0){if(i>0){const a=t;t=s,s=a}if(t.prev===s){const a=t;t=s,s=a}for(let a=0,x=s.rings.length;a<x;a++){const h=s.rings[a],E=s.windings[a],w=t.rings.indexOf(h);w===-1?(t.rings.push(h),t.windings.push(E)):t.windings[w]+=E}s.rings=null,s.windings=null,s.consumedBy=t,s.leftSE.consumedBy=t.leftSE,s.rightSE.consumedBy=t.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};const t=this._afterState.rings,s=this._afterState.windings,i=this._afterState.multiPolys;for(let h=0,E=this.rings.length;h<E;h++){const w=this.rings[h],b=this.windings[h],_=t.indexOf(w);_===-1?(t.push(w),s.push(b)):s[_]+=b}const a=[],x=[];for(let h=0,E=t.length;h<E;h++){if(s[h]===0)continue;const w=t[h],b=w.poly;if(x.indexOf(b)===-1)if(w.isExterior)a.push(b);else{x.indexOf(b)===-1&&x.push(b);const _=a.indexOf(w.poly);_!==-1&&a.splice(_,1)}}for(let h=0,E=a.length;h<E;h++){const w=a[h].multiPoly;i.indexOf(w)===-1&&i.push(w)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const e=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch(re.type){case"union":{const s=e.length===0,i=t.length===0;this._isInResult=s!==i;break}case"intersection":{let s,i;e.length<t.length?(s=e.length,i=t.length):(s=t.length,i=e.length),this._isInResult=i===re.numMultiPolys&&s<i;break}case"xor":{const s=Math.abs(e.length-t.length);this._isInResult=s%2===1;break}case"difference":{const s=i=>i.length===1&&i[0].isSubject;this._isInResult=s(e)!==s(t);break}}return this._isInResult}},et=class{poly;isExterior;segments;bbox;constructor(n,e,t){if(!Array.isArray(n)||n.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=e,this.isExterior=t,this.segments=[],typeof n[0][0]!="number"||typeof n[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const s=te.snap({x:new W(n[0][0]),y:new W(n[0][1])});this.bbox={ll:{x:s.x,y:s.y},ur:{x:s.x,y:s.y}};let i=s;for(let a=1,x=n.length;a<x;a++){if(typeof n[a][0]!="number"||typeof n[a][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const h=te.snap({x:new W(n[a][0]),y:new W(n[a][1])});h.x.eq(i.x)&&h.y.eq(i.y)||(this.segments.push(Ee.fromRing(i,h,this)),h.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=h.x),h.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=h.y),h.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=h.x),h.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=h.y),i=h)}(!s.x.eq(i.x)||!s.y.eq(i.y))&&this.segments.push(Ee.fromRing(i,s,this))}getSweepEvents(){const n=[];for(let e=0,t=this.segments.length;e<t;e++){const s=this.segments[e];n.push(s.leftSE),n.push(s.rightSE)}return n}},xn=class{multiPoly;exteriorRing;interiorRings;bbox;constructor(n,e){if(!Array.isArray(n))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new et(n[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let t=1,s=n.length;t<s;t++){const i=new et(n[t],this,!1);i.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=i.bbox.ll.x),i.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=i.bbox.ll.y),i.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=i.bbox.ur.x),i.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=i.bbox.ur.y),this.interiorRings.push(i)}this.multiPoly=e}getSweepEvents(){const n=this.exteriorRing.getSweepEvents();for(let e=0,t=this.interiorRings.length;e<t;e++){const s=this.interiorRings[e].getSweepEvents();for(let i=0,a=s.length;i<a;i++)n.push(s[i])}return n}},tt=class{isSubject;polys;bbox;constructor(n,e){if(!Array.isArray(n))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof n[0][0][0]=="number"&&(n=[n])}catch{}this.polys=[],this.bbox={ll:{x:new W(Number.POSITIVE_INFINITY),y:new W(Number.POSITIVE_INFINITY)},ur:{x:new W(Number.NEGATIVE_INFINITY),y:new W(Number.NEGATIVE_INFINITY)}};for(let t=0,s=n.length;t<s;t++){const i=new xn(n[t],this);i.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=i.bbox.ll.x),i.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=i.bbox.ll.y),i.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=i.bbox.ur.x),i.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=i.bbox.ur.y),this.polys.push(i)}this.isSubject=e}getSweepEvents(){const n=[];for(let e=0,t=this.polys.length;e<t;e++){const s=this.polys[e].getSweepEvents();for(let i=0,a=s.length;i<a;i++)n.push(s[i])}return n}},he=(n,...e)=>re.run("union",n,e),mn=(n,...e)=>re.run("intersection",n,e),yn=(n,...e)=>re.run("xor",n,e),wn=(n,...e)=>re.run("difference",n,e),En=te.set;const vn=Object.freeze(Object.defineProperty({__proto__:null,difference:wn,intersection:mn,setPrecision:En,union:he,xor:yn},Symbol.toStringTag,{value:"Module"}));function Sn(n){if(!n)throw new Error("geojson is required");switch(n.type){case"Feature":return ht(n);case"FeatureCollection":return _n(n);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return Ve(n);default:throw new Error("unknown GeoJSON type")}}function ht(n){const e={type:"Feature"};return Object.keys(n).forEach(t=>{switch(t){case"type":case"properties":case"geometry":return;default:e[t]=n[t]}}),e.properties=ft(n.properties),n.geometry==null?e.geometry=null:e.geometry=Ve(n.geometry),e}function ft(n){const e={};return n&&Object.keys(n).forEach(t=>{const s=n[t];typeof s=="object"?s===null?e[t]=null:Array.isArray(s)?e[t]=s.map(i=>i):e[t]=ft(s):e[t]=s}),e}function _n(n){const e={type:"FeatureCollection"};return Object.keys(n).forEach(t=>{switch(t){case"type":case"features":return;default:e[t]=n[t]}}),e.features=n.features.map(t=>ht(t)),e}function Ve(n){const e={type:n.type};return n.bbox&&(e.bbox=n.bbox),n.type==="GeometryCollection"?(e.geometries=n.geometries.map(t=>Ve(t)),e):(e.coordinates=pt(n.coordinates),e)}function pt(n){const e=n;return typeof e[0]!="object"?e.slice():e.map(t=>pt(t))}function Tn(n,e,t){var s;const i=(s=t?.mutate)!=null?s:!1;let a=e;e&&i===!1&&(a=Sn(e));const x=On(a);let h=null;return n.type==="FeatureCollection"?h=bn(n):n.type==="Feature"?h=qe(he(n.geometry.coordinates)):h=qe(he(n.coordinates)),h.geometry.coordinates.forEach(function(E){x.geometry.coordinates.push(E[0])}),x}function bn(n){const e=n.features.length===2?he(n.features[0].geometry.coordinates,n.features[1].geometry.coordinates):he.apply(vn,n.features.map(function(t){return t.geometry.coordinates}));return qe(e)}function qe(n){return Wt(n)}function On(n){let t=[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]];return n&&(n.type==="Feature"?t=n.geometry.coordinates:t=n.coordinates),Jt(t)}var In=Tn;const Pn={name:"MapSelect",components:{LayerControl:Mt,TextControl:Pt,UserLocationControl:$t},mixins:[It],props:{stac:{type:Object,default:null},value:{type:Array,default:null}},emits:["input"],data(){return{crs:"EPSG:4326",extent:this.value,dragging:!1}},computed:{...xt(["uiLanguage"]),projectedExtent(){return this.extent?Pe(this.extent,this.crs,this.map.getView().getProjection()):null},help(){return this.extent?this.$t("mapping.bboxSelect.remove"):this.$t("mapping.bboxSelect.add")}},watch:{async stac(){await this.initMap()},uiLanguage(){}},async mounted(){await this.initMap()},methods:{async initMap(){this.map=null,await this.createMap(this.$refs.map,this.stac,!0);const n=t=>{if(t.type==="singleclick")if(this.extent)At(this.projectedExtent,...t.coordinate)&&(this.interaction.setExtent(null),this.interaction.vertexOverlay_.getSource().clear(),this.interaction.vertexFeature_=null);else{let s=this.map.getSize().map(h=>h*.2),i=this.map.getView().calculateExtent(s),a=[i[2]-i[0],i[3]-i[1]],x=[t.coordinate[0]-a[0],t.coordinate[1]-a[1],t.coordinate[0]+a[0],t.coordinate[1]+a[1]];return this.interaction.setExtent(x),!1}else if(this.interaction.handlingDownUpSequence||this.interaction.snapToVertex_(t.pixel,t.map))return!0;return Bt(t)};this.interaction=new Xt({extent:this.projectedExtent,condition:n,boxStyle:Ct()}),this.interaction.on("extentchanged",this.update),this.map.addInteraction(this.interaction),this.stac&&this.addMask(this.stac);let e;if(this.projectedExtent)e=this.projectedExtent;else if(this.stac){const t=this.stac.getBoundingBox();t&&(e=Pe(t,this.crs,this.map.getView().getProjection()))}e&&this.map.getView().fit(e,{padding:[50,50,50,50],maxZoom:this.maxZoom})},addMask(n){if(!n||typeof n.toGeoJSON!="function")return;const e=n.toGeoJSON();if(!e)return;const t=Ft([-180,-90,180,90]),s=In(e,t),i=new Rt().readFeatures(s,{featureProjection:this.map.getView().getProjection()}),a=new Ne({source:new Ce({features:i}),style:new Lt({fill:new Nt({color:"rgba(0, 0, 0, 0.5)"})})});this.map.addLayer(a)},fixX(n){return(n+180)%360-180},fixY(n){return Math.max(-90,Math.min(90,n))},update(n){if(n.extent){this.extent=Pe(n.extent,this.map.getView().getProjection(),this.crs);const e=[this.fixX(this.extent[0]),this.fixY(this.extent[1]),this.fixX(this.extent[2]),this.fixY(this.extent[3])];this.$emit("input",e)}else this.extent=null,this.$emit("input",null)}}},Mn={class:"map-container"},Rn={ref:"map",class:"map"};function Ln(n,e,t,s,i,a){const x=Oe("TextControl"),h=Oe("UserLocationControl"),E=Oe("LayerControl");return Ue(),De("div",Mn,[ce("div",Rn,[de(x,{text:a.help,map:n.map},null,8,["text","map"]),e[0]||(e[0]=$e()),de(h,{map:n.map,maxZoom:n.maxZoom},null,8,["map","maxZoom"]),e[1]||(e[1]=$e()),de(E,{map:n.map,maxZoom:n.maxZoom},null,8,["map","maxZoom"])],512)])}const Dn=nt(Pn,[["render",Ln]]);export{Dn as default};
//# sourceMappingURL=MapSelect-BHPxuFr5.js.map
