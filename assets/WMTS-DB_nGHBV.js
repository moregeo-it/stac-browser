import{z as P,as as z,$ as q,G as K}from"./GeoJSON-DII1Qerq.js";import{T as V}from"./TileGrid-BTQFLLcz.js";import{a as D}from"./tileurlfunction-Dtb_8BT4.js";import{e as U,a as W}from"./uri-BF60_jX7.js";import k from"./TileImage-C0GJS5C3.js";import"./index-DPmgT0xU.js";import"./utils-B7F_ho2D.js";import"./_commonjsHelpers-CE1G-McA.js";import"./I18N-DlIXJTel.js";import"./BFormRadioGroup.vue_vue_type_script_setup_true_lang-LQBMttYK-DOMeCoku.js";import"./useStateClass-BGbSLWFN-BNuqkYB7.js";import"./ConditionalWrapper.vue_vue_type_script_lang-IX_NpHH--BXnPMu4c.js";import"./TileRange-2Tc-Ry00.js";import"./tilecoord-CR7vLr2I.js";import"./Tile-C2uFJL5w.js";import"./Tile-CWLWzuLL.js";import"./common-C7eTg1SE.js";import"./Tile-DdfiLW5t.js";import"./UrlTile-9DfJuXFS.js";import"./TileEventType-CTN_nmJ7.js";class v extends V{constructor(e){super({extent:e.extent,origin:e.origin,origins:e.origins,resolutions:e.resolutions,tileSize:e.tileSize,tileSizes:e.tileSizes,sizes:e.sizes}),this.matrixIds_=e.matrixIds}getMatrixId(e){return this.matrixIds_[e]}getMatrixIds(){return this.matrixIds_}}function X(l,e,r){const i=[],c=[],n=[],f=[],m=[];r=r!==void 0?r:[];const E="SupportedCRS",x="TileMatrix",a="Identifier",j="ScaleDenominator",u="TopLeftCorner",S="TileWidth",b="TileHeight",I=l[E],R=P(I),h=R.getMetersPerUnit(),T=R.getAxisOrientation().startsWith("ne");return l[x].sort(function(s,p){return p[j]-s[j]}),l[x].forEach(function(s){let p;if(r.length>0?p=r.find(function(_){return s[a]==_[x]?!0:s[a].includes(":")?!1:l[a]+":"+s[a]===_[x]}):p=!0,p){c.push(s[a]);const _=s[j]*28e-5/h,C=s[S],d=s[b];T?n.push([s[u][1],s[u][0]]):n.push(s[u]),i.push(_),f.push(C==d?C:[C,d]),m.push([s.MatrixWidth,s.MatrixHeight])}}),new v({extent:e,origins:n,resolutions:i,matrixIds:c,tileSizes:f,sizes:m})}class de extends k{constructor(e){const r=e.requestEncoding!==void 0?e.requestEncoding:"KVP",i=e.tileGrid;let c=e.urls;c===void 0&&e.url!==void 0&&(c=U(e.url)),super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:e.tileClass,tileGrid:i,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,urls:c,wrapX:e.wrapX!==void 0?e.wrapX:!1,transition:e.transition,zDirection:e.zDirection}),this.version_=e.version!==void 0?e.version:"1.0.0",this.format_=e.format!==void 0?e.format:"image/jpeg",this.dimensions_=e.dimensions!==void 0?e.dimensions:{},this.layer_=e.layer,this.matrixSet_=e.matrixSet,this.style_=e.style,this.requestEncoding_=r,this.setKey(this.getKeyForDimensions_()),c&&c.length>0&&(this.tileUrlFunction=D(c.map(this.createFromWMTSTemplate.bind(this))))}setUrls(e){this.urls=e;const r=e.join(`
`);this.setTileUrlFunction(D(e.map(this.createFromWMTSTemplate.bind(this))),r)}getDimensions(){return this.dimensions_}getFormat(){return this.format_}getLayer(){return this.layer_}getMatrixSet(){return this.matrixSet_}getRequestEncoding(){return this.requestEncoding_}getStyle(){return this.style_}getVersion(){return this.version_}getKeyForDimensions_(){const e=this.urls?this.urls.slice(0):[];for(const r in this.dimensions_)e.push(r+"-"+this.dimensions_[r]);return e.join("/")}updateDimensions(e){Object.assign(this.dimensions_,e),this.setKey(this.getKeyForDimensions_())}createFromWMTSTemplate(e){const r=this.requestEncoding_,i={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};r=="KVP"&&Object.assign(i,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_}),e=r=="KVP"?W(e,i):e.replace(/\{(\w+?)\}/g,function(f,m){return m.toLowerCase()in i?i[m.toLowerCase()]:f});const c=this.tileGrid,n=this.dimensions_;return(function(f,m,E){if(!f)return;const x={TileMatrix:c.getMatrixId(f[0]),TileCol:f[1],TileRow:f[2]};Object.assign(x,n);let a=e;return r=="KVP"?a=W(a,x):a=a.replace(/\{(\w+?)\}/g,function(j,u){return encodeURIComponent(x[u])}),a})}}function fe(l,e){const i=l.Contents.Layer?.find(function(t){return t.Identifier==e.layer});if(!i)return null;const c=l.Contents.TileMatrixSet;let n;i.TileMatrixSetLink.length>1?"projection"in e?n=i.TileMatrixSetLink.findIndex(function(t){const y=c.find(function(L){return L.Identifier==t.TileMatrixSet}).SupportedCRS,F=P(y),M=P(e.projection);return F&&M?z(F,M):y==e.projection}):n=i.TileMatrixSetLink.findIndex(function(t){return t.TileMatrixSet==e.matrixSet}):n=0,n<0&&(n=0);const f=i.TileMatrixSetLink[n].TileMatrixSet,m=i.TileMatrixSetLink[n].TileMatrixSetLimits;let E=i.Format[0];"format"in e&&(E=e.format),n=i.Style.findIndex(function(t){return"style"in e?t.Title==e.style:t.isDefault}),n<0&&(n=0);const x=i.Style[n].Identifier,a={};"Dimension"in i&&i.Dimension.forEach(function(t,o,y){const F=t.Identifier;let M=t.Default;M===void 0&&(M=t.Value[0]),a[F]=M});const u=l.Contents.TileMatrixSet.find(function(t){return t.Identifier==f});let S;const b=u.SupportedCRS;if(b&&(S=P(b)),"projection"in e){const t=P(e.projection);t&&(!S||z(t,S))&&(S=t)}let I=!1;const R=S.getAxisOrientation().startsWith("ne");let h=u.TileMatrix[0],T={MinTileCol:0,MinTileRow:0,MaxTileCol:h.MatrixWidth-1,MaxTileRow:h.MatrixHeight-1};if(m){T=m[m.length-1];const t=u.TileMatrix.find(o=>o.Identifier===T.TileMatrix||u.Identifier+":"+o.Identifier===T.TileMatrix);t&&(h=t)}const s=h.ScaleDenominator*28e-5/S.getMetersPerUnit(),p=R?[h.TopLeftCorner[1],h.TopLeftCorner[0]]:h.TopLeftCorner,_=h.TileWidth*s,C=h.TileHeight*s;let d=u.BoundingBox;d&&R&&(d=[d[1],d[0],d[3],d[2]]);let w=[p[0]+_*T.MinTileCol,p[1]-C*(1+T.MaxTileRow),p[0]+_*(1+T.MaxTileCol),p[1]-C*T.MinTileRow];if(d!==void 0&&!q(d,w)){const t=i.WGS84BoundingBox,o=P("EPSG:4326").getExtent();if(w=d,t)I=t[0]===o[0]&&t[2]===o[2];else{const y=K(d,u.SupportedCRS,"EPSG:4326");I=y[0]-1e-10<=o[0]&&y[2]+1e-10>=o[2]}}const O=X(u,w,m),G=[];let g=e.requestEncoding;if(g=g!==void 0?g:"","OperationsMetadata"in l&&"GetTile"in l.OperationsMetadata){const t=l.OperationsMetadata.GetTile.DCP.HTTP.Get;for(let o=0,y=t.length;o<y;++o)if(t[o].Constraint){const M=t[o].Constraint.find(function(L){return L.name=="GetEncoding"}).AllowedValues.Value;if(g===""&&(g=M[0]),g==="KVP")M.includes("KVP")&&G.push(t[o].href);else break}else t[o].href&&(g="KVP",G.push(t[o].href))}return G.length===0&&(g="REST",i.ResourceURL.forEach(function(t){t.resourceType==="tile"&&(E=t.format,G.push(t.template))})),{urls:G,layer:e.layer,matrixSet:f,format:E,projection:S,requestEncoding:g,tileGrid:O,style:x,dimensions:a,wrapX:I,crossOrigin:e.crossOrigin}}export{de as default,fe as optionsFromCapabilities};
//# sourceMappingURL=WMTS-DB_nGHBV.js.map
