import{I as j}from"./Tile-C2uFJL5w.js";import{f as v,aq as D,b3 as R,a2 as L,u as M}from"./GeoJSON-DII1Qerq.js";import{T as Z}from"./TileGrid-BTQFLLcz.js";import{a as k}from"./tileurlfunction-Dtb_8BT4.js";import{e as A}from"./uri-BF60_jX7.js";import O from"./TileImage-C0GJS5C3.js";import"./Tile-CWLWzuLL.js";import"./common-C7eTg1SE.js";import"./index-DPmgT0xU.js";import"./utils-B7F_ho2D.js";import"./_commonjsHelpers-CE1G-McA.js";import"./I18N-DlIXJTel.js";import"./BFormRadioGroup.vue_vue_type_script_setup_true_lang-LQBMttYK-DOMeCoku.js";import"./useStateClass-BGbSLWFN-BNuqkYB7.js";import"./ConditionalWrapper.vue_vue_type_script_lang-IX_NpHH--BXnPMu4c.js";import"./TileRange-2Tc-Ry00.js";import"./tilecoord-CR7vLr2I.js";import"./Tile-DdfiLW5t.js";import"./UrlTile-9DfJuXFS.js";import"./TileEventType-CTN_nmJ7.js";class P extends j{constructor(e,l,a,n,s,c,i){super(l,a,n,s,c,i),this.zoomifyImage_=null,this.tileSize_=e}getImage(){if(this.zoomifyImage_)return this.zoomifyImage_;const e=super.getImage();if(this.state==v.LOADED){const l=this.tileSize_;if(e.width==l[0]&&e.height==l[1])return this.zoomifyImage_=e,e;const a=D(l[0],l[1]);return a.drawImage(e,0,0),this.zoomifyImage_=a.canvas,a.canvas}return e}}class me extends O{constructor(e){const l=e.size,a=e.tierSizeCalculation!==void 0?e.tierSizeCalculation:"default",n=e.tilePixelRatio||1,s=l[0],c=l[1],i=[],u=e.tileSize||R;let r=u*n;switch(a){case"default":for(;s>r||c>r;)i.push([Math.ceil(s/r),Math.ceil(c/r)]),r+=r;break;case"truncated":let t=s,o=c;for(;t>r||o>r;)i.push([Math.ceil(t/r),Math.ceil(o/r)]),t>>=1,o>>=1;break;default:throw new Error("Unknown `tierSizeCalculation` configured")}i.push([1,1]),i.reverse();const m=[n],d=[0];for(let t=1,o=i.length;t<o;t++)m.push(n<<t),d.push(i[t-1][0]*i[t-1][1]+d[t-1]);m.reverse();const p=new Z({tileSize:u,extent:e.extent||[0,-c,s,0],resolutions:m});let h=e.url;h&&!h.includes("{TileGroup}")&&!h.includes("{tileIndex}")&&(h+="{TileGroup}/{z}-{x}-{y}.jpg");const w=A(h);let f=u*n;function y(t){return(function(o,W,q){if(!o)return;const g=o[0],x=o[1],I=o[2],S=x+I*i[g][0],F=(S+d[g])/f|0,G={z:g,x,y:I,tileIndex:S,TileGroup:"TileGroup"+F};return t.replace(/\{(\w+?)\}/g,function(H,b){return G[b]})})}const z=k(w.map(y)),E=P.bind(null,L(u*n));super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,tilePixelRatio:n,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:E,tileGrid:p,tileUrlFunction:z,transition:e.transition}),this.zDirection=e.zDirection;const U=p.getTileCoordForCoordAndResolution(M(p.getExtent()),m[m.length-1]),_=z(U,1,null),T=new Image;T.addEventListener("error",()=>{f=u,this.changed()}),T.src=_}}export{P as CustomTile,me as default};
//# sourceMappingURL=Zoomify-CyUvXJ3g.js.map
