import{U as u,bV as m,bd as w,bb as T}from"./GeoJSON-dVJCj0SI.js";import{c as d,e as f}from"./Tile-oJI9PQZQ.js";import b from"./TileImage-CEJVvt16.js";import"./index-DLQIbJqc.js";import"./utils-B7F_ho2D.js";import"./_commonjsHelpers-CE1G-McA.js";import"./I18N-DlIXJTel.js";import"./BFormRadioGroup.vue_vue_type_script_setup_true_lang-LQBMttYK-CW7mqt87.js";import"./useStateClass-BGbSLWFN-DVCkhww4.js";import"./ConditionalWrapper.vue_vue_type_script_lang-IX_NpHH--D04gVupl.js";import"./tilecoord-CR7vLr2I.js";import"./TileGrid-DzNPHZK1.js";import"./TileRange-2Tc-Ry00.js";import"./Tile-C6wKdysJ.js";import"./Tile-G7aX-9AV.js";import"./common-D17H8Wti.js";import"./UrlTile-CFIfXLkZ.js";import"./tileurlfunction-Bbs9UhLX.js";import"./uri-BP_XjvpC.js";import"./TileEventType-CTN_nmJ7.js";const v="https://tile.googleapis.com/v1/createSession",x="https://tile.googleapis.com/v1/2dtiles",k="https://tile.googleapis.com/tile/v1/viewport",$=22;class B extends b{constructor(t){const i=!!t.highDpi;super({attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,crossOrigin:"anonymous",interpolate:t.interpolate,projection:"EPSG:3857",reprojectionErrorThreshold:t.reprojectionErrorThreshold,state:"loading",tileLoadFunction:t.tileLoadFunction,tilePixelRatio:i?2:1,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,zDirection:t.zDirection}),this.apiKey_=t.key,this.error_=null;const e={mapType:t.mapType||"roadmap",language:t.language||"en-US",region:t.region||"US"};t.imageFormat&&(e.imageFormat=t.imageFormat),t.scale&&(e.scale=t.scale),i&&(e.highDpi=!0),t.layerTypes&&(e.layerTypes=t.layerTypes),t.styles&&(e.styles=t.styles),t.overlay===!0&&(e.overlay=!0),t.apiOptions&&(e.apiOptions=t.apiOptions),this.sessionTokenRequest_=e,this.sessionTokenValue_,this.sessionRefreshId_,this.previousViewportAttribution_,this.previousViewportExtent_,this.createSession_()}getError(){return this.error_}fetchSessionToken(t,i){return fetch(t,i)}async createSession_(){const t=v+"?key="+this.apiKey_,i={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.sessionTokenRequest_)},e=await this.fetchSessionToken(t,i);if(!e.ok){try{const s=await e.json();this.error_=new Error(s.error.message)}catch{this.error_=new Error("Error fetching session token")}this.setState("error");return}const o=await e.json(),n=this.getTilePixelRatio(1),p=[o.tileWidth/n,o.tileHeight/n];this.tileGrid=d({extent:f(this.getProjection()),maxZoom:$,tileSize:p});const c=o.session;this.sessionTokenValue_=c;const r=this.apiKey_;this.tileUrlFunction=function(s,a,S){const g=s[0],y=s[1],_=s[2];return`${x}/${g}/${y}/${_}?session=${c}&key=${r}`};const h=parseInt(o.expiry,10)*1e3,l=Math.max(h-Date.now()-60*1e3,1);this.sessionRefreshId_=setTimeout(()=>this.createSession_(),l),this.setAttributions(this.fetchAttributions_.bind(this)),this.setState("ready")}async fetchAttributions_(t){if(t.viewHints[u.ANIMATING]||t.viewHints[u.INTERACTING]||t.animate)return this.previousViewportAttribution_;const[i,e]=m(w(t.extent),t.viewState.projection),[o,n]=m(T(t.extent),t.viewState.projection),r=`zoom=${this.getTileGrid().getZForResolution(t.viewState.resolution,this.zDirection)}&north=${n}&south=${e}&east=${o}&west=${i}`;if(this.previousViewportExtent_==r)return this.previousViewportAttribution_;this.previousViewportExtent_=r;const h=this.sessionTokenValue_,l=this.apiKey_,s=`${k}?session=${h}&key=${l}&${r}`;return this.previousViewportAttribution_=await fetch(s).then(a=>a.json()).then(a=>a.copyright),this.previousViewportAttribution_}disposeInternal(){clearTimeout(this.sessionRefreshId_),super.disposeInternal()}}export{B as default};
//# sourceMappingURL=Google-Bf2vLPLK.js.map
