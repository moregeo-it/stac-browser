const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Catalogs-DPaG-2YW.js","assets/index-DPmgT0xU.js","assets/utils-B7F_ho2D.js","assets/_commonjsHelpers-CE1G-McA.js","assets/I18N-DlIXJTel.js","assets/index-Dw8SzqbY.css","assets/BBadge.vue_vue_type_script_setup_true_lang-D9DEOOtU-Tez34wsp.js","assets/ConditionalWrapper.vue_vue_type_script_lang-IX_NpHH--BXnPMu4c.js","assets/CardMixin-Tl_NxNHu.js","assets/StacFieldsMixin-Dgc-ZpgP.js","assets/helper-DO3U350M.js","assets/datatypes-XrFOh23H.js","assets/BCard.vue_vue_type_script_setup_true_lang-BjoxuViz-BhoCReIv.js","assets/BCardText.vue_vue_type_script_setup_true_lang-SRGbviaO-BXfpD104.js","assets/Loading-CxaCC6vj.js","assets/Loading-BLYcl2tz.css","assets/Catalogs-CbWoa7rf.css","assets/Items-CAvTUUuG.js","assets/BCollapse.vue_vue_type_script_setup_true_lang-B8TqF-kB-BPJ1mkoe.js","assets/MapView-H3e3WTI0.js","assets/GeoJSON-DII1Qerq.js","assets/BFormRadioGroup.vue_vue_type_script_setup_true_lang-LQBMttYK-DOMeCoku.js","assets/useStateClass-BGbSLWFN-BNuqkYB7.js","assets/GeoJSON-Bh2emOAl.css","assets/WMTSCapabilities-Bh02DQf4.js","assets/Image-C1Bo5M0B.js","assets/ImageLayer-BW_gWP42.js","assets/BaseImage-Di9srpsG.js","assets/Tile-LNQsUUtw.js","assets/TileLayer-C5Rwse32.js","assets/DataTile-DSUQcRYc.js","assets/Tile-CWLWzuLL.js","assets/Tile-C2uFJL5w.js","assets/common-C7eTg1SE.js","assets/TileRange-2Tc-Ry00.js","assets/LRUCache-Bdr1bElJ.js","assets/tilecoord-CR7vLr2I.js","assets/BaseTile-cCAH7WRe.js","assets/TileProperty-BF4LcWSy.js","assets/VectorTile-DXmKRTns.js","assets/WebGLTile-BJR1LLMC.js","assets/compileUtil-DqMMTWIK.js","assets/mat4-CeypvY8Z.js","assets/ImageStatic-BuohJwk7.js","assets/Image-FE7SDcNP.js","assets/resolution-CU8ppKQ3.js","assets/common-9rOs42pz.js","assets/static-CnsnoHkp.js","assets/TileJSON-DOsrMk2Z.js","assets/net-DKPCoeYp.js","assets/Tile-DdfiLW5t.js","assets/TileGrid-BTQFLLcz.js","assets/tileurlfunction-Dtb_8BT4.js","assets/uri-BF60_jX7.js","assets/TileImage-C0GJS5C3.js","assets/UrlTile-9DfJuXFS.js","assets/TileEventType-CTN_nmJ7.js","assets/TileWMS-yZhZPmM8.js","assets/wms-OV0G49kB.js","assets/VectorTile-DObHYoZC.js","assets/WMTS-DB_nGHBV.js","assets/XYZ-BZAem2tm.js","assets/DataTile-D63l5Isx.js","assets/MVT-Bqn5hoxF.js","assets/index-rirIiYoe.js","assets/geotiff-Bm_e7qL3.js","assets/__vite-browser-external-DrV_kz0N.js","assets/MapView-eDbLtyS8.css"])))=>i.map(i=>d[i]);
import{a3 as P,G as m,x as i,E as f,bf as O,d as D,bg as n,v as a,L as r,z as u,y as s,P as c,a$ as q,b2 as N,M as p,N as U,b1 as G,_ as j,aY as H,bm as W,bn as X,bo as S,ch as Y,ci as J,cj as K,ck as Q,bk as w,br as Z,cl as x,cm as ee,cn as te,co as ie,bp as _}from"./index-DPmgT0xU.js";import{j as h}from"./utils-B7F_ho2D.js";import{S as ae}from"./SearchFilter-CEnATNTl.js";import{L as se}from"./Loading-CxaCC6vj.js";import{a as oe,_ as re}from"./BTabs.vue_vue_type_script_setup_true_lang-DJniJmO4-C-gDtj3g.js";import"./_commonjsHelpers-CE1G-McA.js";import"./I18N-DlIXJTel.js";import"./BForm.vue_vue_type_script_setup_true_lang-u44ElAm9-CYaw0yA8.js";import"./BFormInput.vue_vue_type_script_setup_true_lang-D3z3jxbI-CMaDDDlG.js";import"./useStateClass-BGbSLWFN-BNuqkYB7.js";import"./debounce-BHqBzJ1a-bWdYcPta.js";import"./BBadge.vue_vue_type_script_setup_true_lang-D9DEOOtU-Tez34wsp.js";import"./ConditionalWrapper.vue_vue_type_script_lang-IX_NpHH--BXnPMu4c.js";import"./BFormRadioGroup.vue_vue_type_script_setup_true_lang-LQBMttYK-DOMeCoku.js";import"./BFormCheckboxGroup.vue_vue_type_script_setup_true_lang-CZ2qJTp0-vFxVOaO9.js";import"./BFormGroup.vue_vue_type_script_setup_true_lang-BmZN8qcE-D4P934hY.js";import"./BCard.vue_vue_type_script_setup_true_lang-BjoxuViz-BhoCReIv.js";import"./BDropdownText.vue_vue_type_script_setup_true_lang-Cm6QYE9x-CbmqZ1J-.js";import"./index-B9gURfMO.js";import"./__vite-browser-external-DrV_kz0N.js";import"./startOfWeek-BX-gMnB3.js";import"./en-US-DRXoBfJp.js";import"./match-DN4VZKeM.js";import"./buildMatchPatternFn-_eSDZv-o.js";import"./helper-CaHhXSPV.js";import"./helper-DO3U350M.js";const ne={viewBox:"0 0 16 16",width:"1.2em",height:"1.2em"};function le(e,t){return i(),m("svg",ne,[...t[0]||(t[0]=[f("path",{fill:"currentColor",d:"M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"},null,-1)])])}const ce=P({name:"bi-square",render:le}),he={viewBox:"0 0 16 16",width:"1.2em",height:"1.2em"};function ue(e,t){return i(),m("svg",he,[...t[0]||(t[0]=[f("g",{fill:"currentColor"},[f("path",{d:"M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"}),f("path",{d:"M10.97 4.97a.75.75 0 0 1 1.071 1.05l-3.992 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093l3.473-4.425z"})],-1)])])}const de=P({name:"bi-check-square",render:ue}),pe=D({name:"Search",components:{Catalogs:S(()=>_(()=>import("./Catalogs-DPaG-2YW.js").then(e=>e.b),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]))),BTabs:re,BTab:oe,ErrorAlert:Y,Loading:se,SearchFilter:ae,Items:S(()=>_(()=>import("./Items-CAvTUUuG.js"),__vite__mapDeps([17,1,2,3,4,5,6,7,18,8,9,10,11,12,13,14,15]))),MapView:S(()=>_(()=>import("./MapView-H3e3WTI0.js"),__vite__mapDeps([19,1,2,3,4,5,20,21,22,7,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67]))),StacLink:S(()=>_(()=>import("./index-DPmgT0xU.js").then(e=>e.cX),__vite__mapDeps([1,2,3,4,5])))},props:{loadParent:{type:String,default:null}},data(){return{parent:null,error:null,errorId:null,link:null,loading:!1,data:null,itemFilters:{},collectionFilters:{},activeSearch:void 0,selectedCollections:{}}},computed:{...X(["catalogUrl","catalogTitle","searchResultsPerPage","itemsPerPage","collectionsPerPage"]),...W(["canSearchItems","canSearchCollections","getStac","root","collectionLink","parentLink","fromBrowserPath","toBrowserPath"]),selectedCollectionCount(){return h.size(this.selectedCollections)},totalCount(){return typeof this.data.numberMatched=="number"?this.data.numberMatched:null},searchLink(){return this.isCollectionSearch?this.collectionSearch:this.itemSearch},collectionSearch(){return this.canSearchCollections&&this.parent&&this.parent.getApiCollectionsLink()},itemSearch(){return this.canSearchItems&&this.parent&&this.parent.getSearchLink()},resultCollection(){return this.isCollectionSearch?new te({collections:this.results,links:[]}):new ie({type:"FeatureCollection",features:this.results,links:[]})},results(){if(h.size(this.data)===0)return[];let e=this.isCollectionSearch?this.data.collections:this.data.features,t=this.isCollectionSearch?"Collection":"Feature";return Array.isArray(e)?e.map(o=>{try{if(!h.isObject(o)||o.type!==t)return null;let d=h.getLinkWithRel(o.links,"self"),g;d?.href&&(g=h.toAbsolute(d.href,this.link.href));let C=x(o,g,this.toBrowserPath(g));return C=ee(this.$store.state,C),C}catch(d){return console.error(d),null}}).filter(o=>o instanceof w):[]},pagination(){return h.getPaginationLinks(this.data)},filters(){return this.isCollectionSearch?this.collectionFilters:this.itemFilters},isCollectionSearch(){return this.collectionSearch&&this.activeSearch==="search-collections-tab"},pageDescription(){let e=Z([this.collectionLink,this.parentLink,this.root],this.catalogTitle);return this.$t("search.metaDescription",{title:e})},noFurtherItems(){return this.link&&this.link.rel==="next"}},watch:{activeSearch(){this.data=null},searchLink:{immediate:!0,handler(){this.searchLink&&this.showPage()}}},async created(){let e=this.catalogUrl;this.loadParent?(e=this.fromBrowserPath(this.loadParent),this.parent=this.getStac(e)):this.parent=this.root,this.parent||(await this.$store.dispatch("load",{url:e}),this.root||await this.$store.dispatch("config",{catalogUrl:e}),this.parent=this.getStac(e),this.showPage())},methods:{openItemSearch(){this.itemFilters.collections=Object.keys(this.selectedCollections),this.activeSearch="search-items-tab",this.selectedCollections={}},selectForItemSearch(e){this.selectedCollections[e.id]?delete this.selectedCollections[e.id]:this.selectedCollections[e.id]=!0},canFilterItems(e){return e instanceof w?!!e.getApiItemsLink():!1},async loadResults(e){this.error=null,this.errorId=null,this.loading=!0;try{this.link=h.addFiltersToLink(e,this.filters,this.searchResultsPerPage);let t=this.isCollectionSearch?"collections":"features",o=await J(this.$store,this.link);o&&this.showPage(o.config.url),!h.isObject(o.data)||!Array.isArray(o.data[t])?(this.data={},this.error=this.$t(this.isCollectionSearch?"errors.invalidStacCollections":"errors.invalidStacItems")):this.data=o.data}catch(t){this.data={},this.error=K(t),this.errorId=Q(t)}finally{this.loading=!1}},async setFilters(e,t=!1){this.isCollectionSearch?this.collectionFilters=e:this.itemFilters=e,t?this.data=null:await this.loadResults(this.searchLink)},showPage(e){this.$store.commit("showPage",{url:e,page:()=>({title:this.$t("search.title"),description:this.pageDescription})})}}}),me={class:"search d-flex flex-column"},fe={key:0,id:"search-map"},ge={class:"ms-2"};function Ce(e,t,o,d,g,C){const y=n("Loading"),b=n("ErrorAlert"),F=n("SearchFilter"),v=n("b-tab"),L=n("b-tabs"),$=q,k=N,A=n("MapView"),V=de,E=ce,I=j,T=n("StacLink"),B=G,R=n("Catalogs"),M=n("Items"),z=H;return i(),m("main",me,[e.parent?e.searchLink?(i(),a(z,{key:2},{default:s(()=>[c($,{class:"left"},{default:s(()=>[c(L,{modelValue:e.activeSearch,"onUpdate:modelValue":t[0]||(t[0]=l=>e.activeSearch=l)},{default:s(()=>[e.collectionSearch?(i(),a(v,{key:0,title:e.$t("search.tabs.collections"),id:"search-collections-tab"},{default:s(()=>[c(F,{parent:e.parent,title:"",value:e.collectionFilters,type:"Collections",onInput:e.setFilters},null,8,["parent","value","onInput"])]),_:1},8,["title"])):u("",!0),t[1]||(t[1]=r()),e.itemSearch?(i(),a(v,{key:1,title:e.$t("search.tabs.items"),id:"search-items-tab"},{default:s(()=>[c(F,{parent:e.parent,title:"",value:e.itemFilters,type:"Global",onInput:e.setFilters},null,8,["parent","value","onInput"])]),_:1},8,["title"])):u("",!0)]),_:1},8,["modelValue"])]),_:1}),t[5]||(t[5]=r()),c($,{class:"right"},{default:s(()=>[e.loading?(i(),a(y,{key:0,fill:"",top:""})):e.error?(i(),a(b,{key:1,description:e.error,id:e.errorId},null,8,["description","id"])):e.data===null?(i(),a(k,{key:2,variant:"info",show:""},{default:s(()=>[r(p(e.$t("search.modifyCriteria")),1)]),_:1})):e.results.length===0&&e.noFurtherItems?(i(),a(k,{key:3,variant:"info",show:""},{default:s(()=>[r(p(e.$t("search.noFurtherItemsFound")),1)]),_:1})):e.results.length===0?(i(),a(k,{key:4,variant:"warning",show:""},{default:s(()=>[r(p(e.$t("search.noItemsFound")),1)]),_:1})):(i(),m(U,{key:5},[e.resultCollection?(i(),m("div",fe,[c(A,{stac:e.parent,children:e.resultCollection,onfocusOnly:"",popover:""},null,8,["stac","children"])])):u("",!0),t[4]||(t[4]=r()),e.isCollectionSearch?(i(),a(R,{key:1,catalogs:e.results,collectionsOnly:"",pagination:e.pagination,loading:e.loading,onPaginate:e.loadResults,count:e.totalCount,apiFilters:e.collectionFilters},{catalogFooter:s(l=>[e.itemSearch||e.canFilterItems(l.data)?(i(),a(B,{key:0,vertical:"",size:"sm"},{default:s(()=>[e.itemSearch?(i(),a(I,{key:0,variant:"outline-primary",pressed:e.selectedCollections[l.data.id],onClick:ke=>e.selectForItemSearch(l.data)},{default:s(()=>[e.selectedCollections[l.data.id]?(i(),a(V,{key:0})):(i(),a(E,{key:1})),t[2]||(t[2]=r()),f("span",ge,p(e.$t("search.selectForItemSearch")),1)]),_:2},1032,["pressed","onClick"])):u("",!0),t[3]||(t[3]=r()),c(T,{button:{variant:"outline-primary",disabled:!e.canFilterItems(l.data)},data:l.data,title:e.$t("search.filterCollection"),state:{itemFilterOpen:1}},null,8,["button","data","title"])]),_:2},1024)):u("",!0)]),_:1},8,["catalogs","pagination","loading","onPaginate","count","apiFilters"])):(i(),a(M,{key:2,stac:e.parent,items:e.results,api:!0,allowFilter:!1,pagination:e.pagination,loading:e.loading,onPaginate:e.loadResults,count:e.totalCount,apiFilters:e.itemFilters},null,8,["stac","items","pagination","loading","onPaginate","count","apiFilters"]))],64))]),_:1})]),_:1})):(i(),a(b,{key:1,description:e.$t("search.notSupported")},null,8,["description"])):(i(),a(y,{key:0,stretch:""})),t[6]||(t[6]=r()),e.selectedCollectionCount>0?(i(),a(k,{key:3,show:"",variant:"dark",class:"selected-collections-action"},{default:s(()=>[c(I,{onClick:e.openItemSearch,variant:"primary",size:"lg"},{default:s(()=>[r(p(e.$tc("search.useInItemSearch",e.selectedCollectionCount,{count:e.selectedCollectionCount})),1)]),_:1},8,["onClick"])]),_:1})):u("",!0)])}const He=O(pe,[["render",Ce]]);export{He as default};
//# sourceMappingURL=Search-D0-vngoF.js.map
