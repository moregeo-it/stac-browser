import{D as st,b as Rt,t as mt,a as At}from"./DataTile-DSUQcRYc.js";import{bk as pt,b7 as Ft,aA as H,am as Lt,aB as Z,a1 as tt,v as W,be as et,f as F,aq as St,aX as Dt,aY as rt,E as ct,x as it,bl as bt,a2 as V,as as k,g as q,z as Pt,bm as vt}from"./GeoJSON-DII1Qerq.js";import{a as Ut,E as Mt,T as Gt}from"./common-C7eTg1SE.js";import{o as Q,t as Ct,s as ot,a as yt}from"./mat4-CeypvY8Z.js";import{T as wt,c as It,e as Xt,a as Bt,g as Ot}from"./Tile-DdfiLW5t.js";import J from"./TileEventType-CTN_nmJ7.js";import"./Tile-CWLWzuLL.js";import"./index-DPmgT0xU.js";import"./utils-B7F_ho2D.js";import"./_commonjsHelpers-CE1G-McA.js";import"./I18N-DlIXJTel.js";import"./BFormRadioGroup.vue_vue_type_script_setup_true_lang-LQBMttYK-DOMeCoku.js";import"./useStateClass-BGbSLWFN-BNuqkYB7.js";import"./ConditionalWrapper.vue_vue_type_script_lang-IX_NpHH--BXnPMu4c.js";import"./tilecoord-CR7vLr2I.js";import"./TileGrid-BTQFLLcz.js";import"./TileRange-2Tc-Ry00.js";const jt=`
  attribute vec4 a_position;
  attribute vec4 a_texcoord;

  uniform mat4 u_matrix;
  uniform mat4 u_textureMatrix;

  varying vec2 v_texcoord;

  void main() {
    gl_Position = u_matrix * a_position;
    vec2 texcoord = (u_textureMatrix * a_texcoord).xy;
    v_texcoord = texcoord;
  }
`,Nt=`
  precision mediump float;

  varying vec2 v_texcoord;

  uniform sampler2D u_texture;

  void main() {
    if (
      v_texcoord.x < 0.0 ||
      v_texcoord.y < 0.0 ||
      v_texcoord.x > 1.0 ||
      v_texcoord.y > 1.0
    ) {
      discard;
    }
    gl_FragColor = texture2D(u_texture, v_texcoord);
  }
`;class gt{constructor(e){this.gl_=e,this.program_=$(e,Nt,jt),this.positionLocation=e.getAttribLocation(this.program_,"a_position"),this.texcoordLocation=e.getAttribLocation(this.program_,"a_texcoord"),this.matrixLocation=e.getUniformLocation(this.program_,"u_matrix"),this.textureMatrixLocation=e.getUniformLocation(this.program_,"u_textureMatrix"),this.textureLocation=e.getUniformLocation(this.program_,"u_texture"),this.positionBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.positionBuffer),this.positions=[0,0,0,1,1,0,1,0,0,1,1,1],e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.positions),e.STATIC_DRAW),this.texcoordBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.texcoordBuffer),this.texcoords=[0,0,0,1,1,0,1,0,0,1,1,1],e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.texcoords),e.STATIC_DRAW)}drawImage(e,o,i,n,a,R,E,L,S,G,A,_,f){const r=this.gl_;L===void 0&&(L=n),S===void 0&&(S=a),R===void 0&&(R=o),E===void 0&&(E=i),G===void 0&&(G=R),A===void 0&&(A=E),_===void 0&&(_=r.canvas.width),f===void 0&&(f=r.canvas.height),r.bindTexture(r.TEXTURE_2D,e),r.useProgram(this.program_),r.bindBuffer(r.ARRAY_BUFFER,this.positionBuffer),r.enableVertexAttribArray(this.positionLocation),r.vertexAttribPointer(this.positionLocation,2,r.FLOAT,!1,0,0),r.bindBuffer(r.ARRAY_BUFFER,this.texcoordBuffer),r.enableVertexAttribArray(this.texcoordLocation),r.vertexAttribPointer(this.texcoordLocation,2,r.FLOAT,!1,0,0);let c=Q(0,_,0,f,-1,1);c=Ct(c,L,S,0),c=ot(c,G,A,1),r.uniformMatrix4fv(this.matrixLocation,!1,c);let p=yt(n/o,a/i,0);p=ot(p,R/o,E/i,1),r.uniformMatrix4fv(this.textureMatrixLocation,!1,p),r.uniform1i(this.textureLocation,0),r.drawArrays(r.TRIANGLES,0,this.positions.length/2)}}function nt(t,e,o){const i=t.createShader(e);if(i===null)throw new Error("Shader compilation failed");if(t.shaderSource(i,o),t.compileShader(i),!t.getShaderParameter(i,t.COMPILE_STATUS)){const n=t.getShaderInfoLog(i);throw n===null?new Error("Shader info log creation failed"):new Error(n)}return i}function $(t,e,o){const i=t.createProgram(),n=nt(t,t.VERTEX_SHADER,o),a=nt(t,t.FRAGMENT_SHADER,e);if(i===null)throw new Error("Program creation failed");if(t.attachShader(i,n),t.attachShader(i,a),t.linkProgram(i),!t.getProgramParameter(i,t.LINK_STATUS))throw t.getProgramInfoLog(i)===null?new Error("Program info log creation failed"):new Error;return i}const zt=`
  attribute vec4 a_position;

  uniform mat4 u_matrix;

  void main() {
     gl_Position = u_matrix * a_position;
  }
`,Yt=`
  precision mediump float;

  uniform vec4 u_val;
  void main() {
     gl_FragColor = u_val;
  }
`,Kt=`
  attribute vec4 a_position;
  attribute vec2 a_texcoord;

  varying vec2 v_texcoord;

  uniform mat4 u_matrix;

  void main() {
     gl_Position = u_matrix * a_position;
     v_texcoord = a_texcoord;
  }
`,Wt=`
  precision mediump float;

  varying vec2 v_texcoord;

  uniform sampler2D u_texture;

  void main() {
    if (v_texcoord.x < 0.0 || v_texcoord.x > 1.0 || v_texcoord.y < 0.0 || v_texcoord.y > 1.0) {
      discard;
    }
    gl_FragColor = texture2D(u_texture, v_texcoord);
  }
`;function Ht(t,e,o,i){let n;return o&&o.length?n=o.shift():pt?n=new OffscreenCanvas(t||300,e||300):n=document.createElement("canvas"),t&&(n.width=t),e&&(n.height=e),n.getContext("webgl",i)}function Zt(t){const e=t.canvas;e.width=1,e.height=1,t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT)}const at=[];function Vt(t,e,o,i,n,a,R,E,L,S,G,A,_,f){const r=Math.round(i*e),c=Math.round(i*o);t.canvas.width=r,t.canvas.height=c;let p,U;if(U=t.createTexture(),t.bindTexture(t.TEXTURE_2D,U),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),_?(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR)):(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST)),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,r,c,0,t.RGBA,G,null),p=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,p),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,U,0),p===null)throw new Error("Could not create framebuffer");if(U===null)throw new Error("Could not create texture");if(L.length===0)return{width:r,height:c,framebuffer:p,texture:U};const h=Lt();L.forEach(function(s,D,u){Ft(h,s.extent)});let g,T,x;const v=1/n;{if(g=t.createTexture(),U===null)throw new Error("Could not create texture");T=Math.round(H(h)*v),x=Math.round(Z(h)*v);const s=t.getParameter(t.MAX_TEXTURE_SIZE),D=Math.max(T,x),u=D>s?s/D:1,m=Math.round(T*u),M=Math.round(x*u);t.bindTexture(t.TEXTURE_2D,g),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),_?(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR)):(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST)),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,m,M,0,t.RGBA,G,null);const l=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,l),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,g,0);const X=new gt(t);L.forEach(function(d,B,C){const b=(d.extent[0]-h[0])*v*u,I=-(d.extent[3]-h[3])*v*u,j=H(d.extent)*v*u,P=Z(d.extent)*v*u;if(t.bindFramebuffer(t.FRAMEBUFFER,l),t.viewport(0,0,m,M),d.clipExtent){const O=(d.clipExtent[0]-h[0])*v*u,N=-(d.clipExtent[3]-h[3])*v*u,Y=H(d.clipExtent)*v*u,K=Z(d.clipExtent)*v*u;t.enable(t.SCISSOR_TEST),t.scissor(_?O:Math.round(O),_?N:Math.round(N),_?Y:Math.round(O+Y)-Math.round(O),_?K:Math.round(N+K)-Math.round(N))}X.drawImage(d.texture,d.width,d.height,S,S,d.width-2*S,d.height-2*S,_?b:Math.round(b),_?I:Math.round(I),_?j:Math.round(b+j)-Math.round(b),_?P:Math.round(I+P)-Math.round(I),m,M),t.disable(t.SCISSOR_TEST)}),t.deleteFramebuffer(l)}const y=tt(R),w=tt(h),z=s=>{const D=(s[0][0]-y[0])/a*i,u=-(s[0][1]-y[1])/a*i,m=(s[1][0]-y[0])/a*i,M=-(s[1][1]-y[1])/a*i,l=(s[2][0]-y[0])/a*i,X=-(s[2][1]-y[1])/a*i;return{u1:m,v1:M,u0:D,v0:u,u2:l,v2:X}};t.bindFramebuffer(t.FRAMEBUFFER,p),t.viewport(0,0,r,c);{const s=[],D=[],u=$(t,Wt,Kt);t.useProgram(u);const m=t.getUniformLocation(u,"u_texture");t.bindTexture(t.TEXTURE_2D,g),t.uniform1i(m,0),E.getTriangles().forEach(function(b,I,j){const P=b.source,O=b.target,{u1:N,v1:Y,u0:K,v0:ut,u2:Et,v2:_t}=z(O),ft=(P[0][0]-w[0])/n/T,ht=-(P[0][1]-w[1])/n/x,Tt=(P[1][0]-w[0])/n/T,dt=-(P[1][1]-w[1])/n/x,lt=(P[2][0]-w[0])/n/T,xt=-(P[2][1]-w[1])/n/x;s.push(N,Y,K,ut,Et,_t),D.push(Tt,dt,ft,ht,lt,xt)});const M=Q(0,r,c,0,-1,1),l=t.getUniformLocation(u,"u_matrix");t.uniformMatrix4fv(l,!1,M);const X=t.getAttribLocation(u,"a_position"),d=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,d),t.bufferData(t.ARRAY_BUFFER,new Float32Array(s),t.STATIC_DRAW),t.vertexAttribPointer(X,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(X);const B=t.getAttribLocation(u,"a_texcoord"),C=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,C),t.bufferData(t.ARRAY_BUFFER,new Float32Array(D),t.STATIC_DRAW),t.vertexAttribPointer(B,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(B),t.drawArrays(t.TRIANGLES,0,s.length/2)}if(A){const s=$(t,Yt,zt);t.useProgram(s);const D=Q(0,r,c,0,-1,1),u=t.getUniformLocation(s,"u_matrix");t.uniformMatrix4fv(u,!1,D);const m=Array.isArray(A)?A:[0,0,0,255],M=t.getUniformLocation(s,"u_val");t.uniform4fv(M,m);const l=t.getAttribLocation(s,"a_position"),X=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,X),t.vertexAttribPointer(l,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(l);const d=E.getTriangles().reduce(function(B,C){const b=C.target,{u1:I,v1:j,u0:P,v0:O,u2:N,v2:Y}=z(b);return B.concat([I,j,P,O,P,O,N,Y,N,Y,I,j])},[]);t.bufferData(t.ARRAY_BUFFER,new Float32Array(d),t.STATIC_DRAW),t.drawArrays(t.LINES,0,d.length/2)}return{width:r,height:c,framebuffer:p,texture:U}}class kt extends st{constructor(e){super({tileCoord:e.tileCoord,loader:()=>Promise.resolve(new Uint8ClampedArray(4)),interpolate:e.interpolate,transition:e.transition}),this.renderEdges_=e.renderEdges!==void 0?e.renderEdges:!1,this.pixelRatio_=e.pixelRatio,this.gutter_=e.gutter,this.reprojData_=null,this.reprojError_=null,this.reprojSize_=void 0,this.sourceTileGrid_=e.sourceTileGrid,this.targetTileGrid_=e.targetTileGrid,this.wrappedTileCoord_=e.wrappedTileCoord||e.tileCoord,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const o=e.sourceProj,i=o.getExtent(),n=e.sourceTileGrid.getExtent();this.clipExtent_=o.canWrapX()?n?W(i,n):i:n;const a=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),R=this.targetTileGrid_.getExtent();let E=this.sourceTileGrid_.getExtent();const L=R?W(a,R):a;if(et(L)===0){this.state=F.EMPTY;return}i&&(E?E=W(E,i):E=i);const S=this.targetTileGrid_.getResolution(this.wrappedTileCoord_[0]),G=e.targetProj,A=Ut(o,G,L,S);if(!isFinite(A)||A<=0){this.state=F.EMPTY;return}const _=e.errorThreshold!==void 0?e.errorThreshold:Mt;if(this.triangulation_=new Gt(o,G,L,E,A*_,S,e.transformMatrix),this.triangulation_.getTriangles().length===0){this.state=F.EMPTY;return}this.sourceZ_=this.sourceTileGrid_.getZForResolution(A);let f=this.triangulation_.calculateSourceExtent();if(E&&(o.canWrapX()?(f[1]=it(f[1],E[1],E[3]),f[3]=it(f[3],E[1],E[3])):f=W(f,E)),!et(f))this.state=F.EMPTY;else{let r=0,c=0;o.canWrapX()&&(r=H(i),c=Math.floor((f[0]-i[0])/r)),bt(f.slice(),o,!0).forEach(U=>{const h=this.sourceTileGrid_.getTileRangeForExtentAndZ(U,this.sourceZ_),g=e.getTileFunction;for(let T=h.minX;T<=h.maxX;T++)for(let x=h.minY;x<=h.maxY;x++){const v=g(this.sourceZ_,T,x,this.pixelRatio_);if(v){const y=c*r;this.sourceTiles_.push({tile:v,offset:y})}}++c}),this.sourceTiles_.length===0&&(this.state=F.EMPTY)}}getSize(){return this.reprojSize_}getData(){return this.reprojData_}getError(){return this.reprojError_}reproject_(){const e=[];let o=!1;if(this.sourceTiles_.forEach(T=>{const x=T.tile;if(!x||x.getState()!==F.LOADED)return;const v=x.getSize(),y=this.gutter_;let w;const z=Rt(x.getData());z?w=z:(o=!0,w=mt(At(x.getData())));const s=[v[0]+2*y,v[1]+2*y],D=w instanceof Float32Array,u=s[0]*s[1],m=D?Float32Array:Uint8ClampedArray,M=new m(w.buffer),l=m.BYTES_PER_ELEMENT,X=l*M.length/u,d=M.byteLength/s[1],B=Math.floor(d/l/s[0]),C=this.sourceTileGrid_.getTileCoordExtent(x.tileCoord);C[0]+=T.offset,C[2]+=T.offset;const b=this.clipExtent_?.slice();b&&(b[0]+=T.offset,b[2]+=T.offset),e.push({extent:C,clipExtent:b,data:M,dataType:m,bytesPerPixel:X,pixelSize:s,bandCount:B})}),this.sourceTiles_.length=0,e.length===0){this.state=F.ERROR,this.changed();return}const i=this.wrappedTileCoord_[0],n=this.targetTileGrid_.getTileSize(i),a=typeof n=="number"?n:n[0],R=typeof n=="number"?n:n[1],E=a*this.pixelRatio_,L=R*this.pixelRatio_,S=this.targetTileGrid_.getResolution(i),G=this.sourceTileGrid_.getResolution(this.sourceZ_),A=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),_=e[0].bandCount,f=new e[0].dataType(_*E*L),r=Ht(E,L,at,{premultipliedAlpha:!1,antialias:!1});let c;const p=r.RGBA;let U;e[0].dataType==Float32Array?(U=r.FLOAT,r.getExtension("WEBGL_color_buffer_float"),r.getExtension("OES_texture_float"),r.getExtension("EXT_float_blend"),c=r.getExtension("OES_texture_float_linear")!==null&&this.interpolate):(U=r.UNSIGNED_BYTE,c=this.interpolate);const h=4,g=Math.ceil(_/h);for(let T=g-1;T>=0;--T){const x=[];for(let m=0,M=e.length;m<M;++m){const l=e[m],X=l.pixelSize,d=X[0],B=X[1],C=new l.dataType(h*d*B),b=l.data;let I=T*h;for(let P=0,O=C.length;P<O;P+=h)C[P]=b[I],C[P+1]=b[I+1],C[P+2]=b[I+2],C[P+3]=b[I+3],I+=_;const j=r.createTexture();r.bindTexture(r.TEXTURE_2D,j),c?(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR)):(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST)),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texImage2D(r.TEXTURE_2D,0,p,d,B,0,p,U,C),x.push({extent:l.extent,clipExtent:l.clipExtent,texture:j,width:d,height:B})}const{framebuffer:v,width:y,height:w}=Vt(r,a,R,this.pixelRatio_,G,S,A,this.triangulation_,x,this.gutter_,U,this.renderEdges_,c),z=y,s=w*h,D=new e[0].dataType(z*s);r.bindFramebuffer(r.FRAMEBUFFER,v),r.readPixels(0,0,y,w,r.RGBA,U,D);let u=T*h;for(let m=0,M=D.length;m<M;m+=h){const l=(z-1-(m/s|0))*s+m%s;f[u]=D[l],f[u+1]=D[l+1],f[u+2]=D[l+2],f[u+3]=D[l+3],u+=_}}if(Zt(r),at.push(r.canvas),o){const T=St(a,R),x=new ImageData(f,a);T.putImageData(x,0,0),this.reprojData_=T.canvas}else this.reprojData_=f;this.reprojSize_=[Math.round(E),Math.round(L)],this.state=F.LOADED,this.changed()}load(){if(this.state!==F.IDLE&&this.state!==F.ERROR)return;this.state=F.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:o})=>{const i=o.getState();if(i!==F.IDLE&&i!==F.LOADING)return;e++;const n=Dt(o,ct.CHANGE,()=>{const a=o.getState();(a==F.LOADED||a==F.ERROR||a==F.EMPTY)&&(rt(n),e--,e===0&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(n)}),e===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:o}){o.getState()==F.IDLE&&o.load()})}unlistenSources_(){this.sourcesListenerKeys_.forEach(rt),this.sourcesListenerKeys_=null}}class he extends wt{constructor(e){const o=e.projection===void 0?"EPSG:3857":e.projection;let i=e.tileGrid;i===void 0&&o&&(i=It({extent:Xt(o),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize})),super({cacheSize:.1,attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:o,tileGrid:i,state:e.state,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate,key:e.key,zDirection:e.zDirection}),this.gutter_=e.gutter!==void 0?e.gutter:0,this.tileSize_=e.tileSize?V(e.tileSize):null,this.tileSizes_=null,this.tileLoadingKeys_={},this.loader_=e.loader,this.handleTileChange_=this.handleTileChange_.bind(this),this.bandCount=e.bandCount===void 0?4:e.bandCount,this.tileGridForProjection_={},this.crossOrigin_=e.crossOrigin||"anonymous",this.transformMatrix=null}setTileSizes(e){this.tileSizes_=e}getTileSize(e){if(this.tileSizes_)return this.tileSizes_[e];if(this.tileSize_)return this.tileSize_;const o=this.getTileGrid();return o?V(o.getTileSize(e)):[256,256]}getGutterForProjection(e){const o=this.getProjection();return(!o||k(o,e))&&!this.transformMatrix?this.gutter_:0}setLoader(e){this.loader_=e}getReprojTile_(e,o,i,n,a){const R=this.tileGrid||this.getTileGridForProjection(a||n),E=Math.max.apply(null,R.getResolutions().map((f,r)=>{const c=V(R.getTileSize(r)),p=this.getTileSize(r);return Math.max(p[0]/c[0],p[1]/c[1])})),L=this.getTileGridForProjection(n),S=[e,o,i],G=this.getTileCoordForTileUrlFunction(S,n),A=Object.assign({sourceProj:a||n,sourceTileGrid:R,targetProj:n,targetTileGrid:L,tileCoord:S,wrappedTileCoord:G,pixelRatio:E,gutter:this.gutter_,getTileFunction:(f,r,c,p)=>this.getTile(f,r,c,p),transformMatrix:this.transformMatrix},this.tileOptions),_=new kt(A);return _.key=this.getKey(),_}getTile(e,o,i,n,a){const R=this.getProjection();if(a&&(R&&!k(R,a)||this.transformMatrix))return this.getReprojTile_(e,o,i,a,R);const E=this.getTileSize(e),L=this.loader_,S=new AbortController,G={signal:S.signal,crossOrigin:this.crossOrigin_},A=this.getTileCoordForTileUrlFunction([e,o,i]);if(!A)return null;const _=A[0],f=A[1],r=A[2],c=this.getTileGrid()?.getFullTileRange(_);c&&(G.maxY=c.getHeight()-1);function p(){return vt(function(){return L(_,f,r,G)})}const U=Object.assign({tileCoord:[e,o,i],loader:p,size:E,controller:S},this.tileOptions),h=new st(U);return h.key=this.getKey(),h.addEventListener(ct.CHANGE,this.handleTileChange_),h}handleTileChange_(e){const o=e.target,i=q(o),n=o.getState();let a;n==F.LOADING?(this.tileLoadingKeys_[i]=!0,a=J.TILELOADSTART):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],a=n==F.ERROR?J.TILELOADERROR:n==F.LOADED?J.TILELOADEND:void 0),a&&this.dispatchEvent(new Bt(a,o))}getTileGridForProjection(e){const o=this.getProjection();if(this.tileGrid&&(!o||k(o,e))&&!this.transformMatrix)return this.tileGrid;const i=q(e);return i in this.tileGridForProjection_||(this.tileGridForProjection_[i]=Ot(e)),this.tileGridForProjection_[i]}setTileGridForProjection(e,o){const i=Pt(e);if(i){const n=q(i);n in this.tileGridForProjection_||(this.tileGridForProjection_[n]=o)}}}export{he as default};
//# sourceMappingURL=DataTile-D63l5Isx.js.map
