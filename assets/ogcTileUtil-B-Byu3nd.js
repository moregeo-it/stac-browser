import{l as X,z as M,v as Y}from"./GeoJSON-DII1Qerq.js";import{g as L,r as v}from"./net-DKPCoeYp.js";import{T as $}from"./TileGrid-BTQFLLcz.js";import"./index-DPmgT0xU.js";import"./utils-B7F_ho2D.js";import"./_commonjsHelpers-CE1G-McA.js";import"./I18N-DlIXJTel.js";import"./BFormRadioGroup.vue_vue_type_script_setup_true_lang-LQBMttYK-DOMeCoku.js";import"./useStateClass-BGbSLWFN-BNuqkYB7.js";import"./ConditionalWrapper.vue_vue_type_script_lang-IX_NpHH--BXnPMu4c.js";import"./TileRange-2Tc-Ry00.js";import"./tilecoord-CR7vLr2I.js";const q={"image/png":!0,"image/jpeg":!0,"image/gif":!0,"image/webp":!0},F={"application/vnd.mapbox-vector-tile":!0,"application/geo+json":!0};function W(t,n){if(!n.length)return t;const o=new URL(t,"file:/");if(o.pathname.split("/").includes("collections"))return X('The "collections" query parameter cannot be added to collection endpoints'),t;const r=n.map(l=>encodeURIComponent(l)).join(",");o.searchParams.append("collections",r);const i=t.split("?")[0],a=decodeURIComponent(o.searchParams.toString());return`${i}?${a}`}function G(t,n,o){let r,i;for(let a=0;a<t.length;++a){const l=t[a];if(l.rel==="item"){if(l.type===n){r=l.href;break}(q[l.type]||!i&&l.type.startsWith("image/"))&&(i=l.href)}}if(!r)if(i)r=i;else throw new Error('Could not find "item" link');return o&&(r=W(r,o)),r}function J(t,n,o,r){let i,a;const l={};for(let p=0;p<t.length;++p){const s=t[p];if(l[s.type]=s.href,s.rel==="item"){if(s.type===n){i=s.href;break}F[s.type]&&(a=s.href)}}if(!i&&o)for(let p=0;p<o.length;++p){const s=o[p];if(l[s]){i=l[s];break}}if(!i)if(a)i=a;else throw new Error('Could not find "item" link');return r&&(i=W(i,r)),i}function A(t,n,o,r){let i=t.projection;if(!i&&(typeof n.crs=="string"?i=M(n.crs):"uri"in n.crs&&(i=M(n.crs.uri)),!i))throw new Error(`Unsupported CRS: ${JSON.stringify(n.crs)}`);const a=n.orderedAxes,p=!(a?a.slice(0,2).map(e=>e.replace(/E|X|Lon/i,"e").replace(/N|Y|Lat/i,"n")).join(""):i.getAxisOrientation()).startsWith("en"),s=n.tileMatrices,y={};for(let e=0;e<s.length;++e){const f=s[e];y[f.id]=f}const k={},w=[];if(r)for(let e=0;e<r.length;++e){const f=r[e],c=f.tileMatrix;w.push(c),k[c]=f}else for(let e=0;e<s.length;++e){const f=s[e].id;w.push(f)}const x=w.length,u=new Array(x),j=new Array(x),z=new Array(x),E=new Array(x),b=[-1/0,-1/0,1/0,1/0];for(let e=0;e<x;++e){const f=w[e],c=y[f],h=c.pointOfOrigin;p?u[e]=[h[1],h[0]]:u[e]=h,j[e]=c.cellSize,z[e]=[c.matrixWidth,c.matrixHeight],E[e]=[c.tileWidth,c.tileHeight];const m=k[f];if(m){const T=c.cellSize*c.tileWidth,g=u[e][0]+m.minTileCol*T,R=u[e][0]+(m.maxTileCol+1)*T,d=c.cellSize*c.tileHeight,O=c.cornerOfOrigin==="bottomLeft";let C,U;O?(C=u[e][1]+m.minTileRow*d,U=u[e][1]+(m.maxTileRow+1)*d):(C=u[e][1]-(m.maxTileRow+1)*d,U=u[e][1]-m.minTileRow*d),Y(b,[g,C,R,U],b)}}const H=new $({origins:u,resolutions:j,sizes:z,tileSizes:E,extent:r?b:void 0}),P=t.context,D=t.url;function N(e,f,c){if(!e)return;const h=w[e[0]],m=y[h],T=m.cornerOfOrigin==="bottomLeft",g={tileMatrix:h,tileCol:e[1],tileRow:T?-e[2]-1:e[2]};if(r){const d=k[m.id];if(g.tileCol<d.minTileCol||g.tileCol>d.maxTileCol||g.tileRow<d.minTileRow||g.tileRow>d.maxTileRow)return}Object.assign(g,P);const R=o.replace(/\{(\w+?)\}/g,function(d,O){return g[O]});return v(D,R)}return{grid:H,projection:i,urlTemplate:o,urlFunction:N}}function S(t,n){const o=n.tileMatrixSetLimits;let r;if(n.dataType==="map")r=G(n.links,t.mediaType,t.collections);else if(n.dataType==="vector")r=J(n.links,t.mediaType,t.supportedMediaTypes,t.collections);else throw new Error('Expected tileset data type to be "map" or "vector"');if(n.tileMatrixSet)return A(t,n.tileMatrixSet,r,o);const i=n.links.find(p=>p.rel==="http://www.opengis.net/def/rel/ogc/1.0/tiling-scheme");if(!i)throw new Error("Expected http://www.opengis.net/def/rel/ogc/1.0/tiling-scheme link or tileMatrixSet");const a=i.href,l=v(t.url,a);return L(l).then(function(p){return A(t,p,r,o)})}function oe(t){return L(t.url).then(function(n){return S(t,n)})}export{W as appendCollectionsQueryParam,G as getMapTileUrlTemplate,oe as getTileSetInfo,J as getVectorTileUrlTemplate};
//# sourceMappingURL=ogcTileUtil-B-Byu3nd.js.map
